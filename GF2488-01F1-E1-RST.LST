C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE GF2488_01F1_E1_RST
OBJECT MODULE PLACED IN GF2488-01F1-E1-RST.OBJ
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE GF2488-01F1-E1-RST.C LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND T
                    -ABS(2)

line level    source

   1          /******************************************************************
   2          ** ÎÄ¼þÃû£ºSTAND.C
   3          ** Copyright (c) 2002 ·é»ðÍ¨ÐÅ´«Êä²úÆ·²¿BCTÈí¼þ×é
   4          ** ´´½¨ÈË£ºÎÌÒæêÍ
   5          ** ÎÄ¼þ±àºÅ£º
   6          ** Ãè¡¡Êö£º±ê×¼Ä£°æ³ÌÐò
   7          **         
   8          ** ÈÕ¡¡ÆÚ£º2002.6.28
   9          ** ÐÞ¸ÄÈË£º
  10          ** ÈÕ¡¡ÆÚ£º
  11          ** ÎÄ¼þ±àºÅ£º
  12          ** Ãè¡¡Êö£º
  13          **
  14          **
  15          ** ±àÒëÆ÷£ºKeil C51 V5.5 »ò MCC68K V4.4
  16          ** ¹«¹²¿â£ºNewLib9.LIB for Mcs51
  17          **         »ò NewLib1.LIB for Mc68302
  18          ** °æ  ±¾£º1.0
  19          ********************************************************************/
  20          //#define  NEED_LP_RFI   /**  !!! µ¥ÅÌÆð²»À´ÁË  */
  21          #define AIS_CONDITIONS
  22          #define SKIP_DEBUG_CHECK
  23          
  24          #define UASNUM    63        //Òª¼ÆËãÎóÂëµÄÏßÂ·Êý63//
  25          #define LINENUM   64        /*¸æ¾¯ÏßÂ·ÊýÎª64*/
  26          #ifdef NEED_LP_RFI
                #define ALMNUM      822     /*×Ü¹²63*(ALMTYPENUM-3)+3=759¸ö¸æ¾¯*/
                #define ALMTYPENUM      16      /*16ÖÖ¸æ¾¯ÀàÐÍ*/
              #else
  30            #define ALMNUM      759     /*×Ü¹²63*(ALMTYPENUM-3)+3=759¸ö¸æ¾¯*/
  31            #define ALMTYPENUM      15      /*15ÖÖ¸æ¾¯ÀàÐÍ*/
  32          #endif
  33          
  34          #define PMNUM   441         /*×Ü¹²63*PMTYPENUM¸öÐÔÄÜ*/
  35          
  36          #define PMTYPENUM       7       /*7ÖÖÐÔÄÜÀàÐÍ*/
  37          #define CONFLEN   2560  /*ÅäÖÃÊý¾Ý³¤¶ÈÎª2560*/
  38          #define STATELEN  338   /*×´Ì¬Êý¾Ý³¤¶ÈÎª338*/
  39          #define BOARDCODE 0x96  /*ÅÌ´úÂë*/
  40          #define WGS21891A 0xB000
  41          
  42          #define SW1021  0xB000    //TODO£ºconfirm
  43          
  44          #define SW1021_CHIP_ADDR(num)  (SW1021 + 0x1000*(num))
  45          //#define SW1021_CHIP_ADDR(num)  (0xD000)
  46          #define CHIPS_ON_BOARD          3
  47          
  48          
  49          #include "commvar9.h"
  50          #include "uasE63.h"
  51          
  52          #include "sw1021.h"
  53          
  54          char code SysName[]="GF2488-01F";
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 2   

  55          char code BoardName[]="E1-63A";
  56          char code BoardSn[]="WKE2.170.609R1B";
  57          char code SoftVer[]="R170609R1B/01F    ";
  58          
  59          char code PcbSn[]="WKE7.822.828R1B";
  60          char code PcbTime[]="2004 05 02";
  61          
  62          char code BoardSoftVer[]="RP0100            ";
  63          
  64          char code SoftDate[]=__DATE__;
  65          char code SoftTime[]=__TIME__;
  66          
  67          extern int sprintf(char *, const char *, ...);
  68          
  69          #define RSTB IO0
  70          #define TUALMO IO2
  71          #define TUXAB IO5 //TUXABÎªÖ÷±¸½»²æÊ±ÖÓÅÌXCUÓÐÐ§Ö¸Ê¾ÐÅºÅ,Ö÷ÓÃXCUÓÐÐ§Ê±TUXAB=0,±¸ÓÃXCUÓÐÐ§TUXAB=1
  72          #define WP IO6     //E1-63AÅÌÔÚÕý³£²ÛÎ»Ê±WP=1,ÔÚ±£»¤²ÛÎ»Ê±WP=0//
  73          #define TUSWTI IO7 //±¾ÅÌalmnumber´óÓÚÒ»¶¨ÖµÊ±,TUALMO=1,XCUÅÌÊÕµ½TUALMO=1Ê±,²úÉúTUSWTI=0//
  74          #define P2V5 IO8
  75          #define P5VI1 IO9
  76          #define P5VI2 IO10
  77          #define DZBI1 IO11
  78          #define DZBI2 IO12
  79          extern unsigned char g_AllClrFlag;
  80          extern unsigned char g_LampEn;
  81          unsigned int ulEsLimit,ulSesLimit;
  82          //unsigned int WGS21891,wgs21891reg0[4],wgs21891reg1[4];
  83          unsigned int sw1021Chip;
  84          unsigned int N1000[63],BIP[63],BIP_2_1S[63],BIP_2_1000S[63];
  85          unsigned char actnumber,almnumber,first_conf;
  86          /*
  87          code unsigned char slot[64]={1,22,43,4,25,46,7,
  88          28,49,10,31,52,13,34,
  89          55,16,37,58,19,40,61,
  90          
  91          2,23,44,5,26,47,8,
  92          29,50,11,32,53,14,35,
  93          56,17,38,59,20,41,62,
  94          
  95          3,24,45,6,27,48,9,
  96          30,51,12,33,54,15,36,
  97          57,18,39,60,21,42,63,0};
  98              */
  99          /*
 100          code unsigned char slot[64]={0x00,0x20,0x40,0x01,0x21,0x41,0x02,
 101                               0x22,0x42,0x03,0x23,0x43,0x04,0x24,
 102                               0x44,0x05,0x25,0x45,0x06,0x26,0x46,
 103          
 104                               0x07,0x27,0x47,0x08,0x28,0x48,0x09,
 105                               0x29,0x49,0x0a,0x2a,0x4a,0x0b,0x2b,
 106                               0x4b,0x0c,0x2c,0x4c,0x0d,0x2d,0x4d,
 107          
 108                               0x0e,0x2e,0x4e,0x0f,0x2f,0x4f,0x10,
 109                               0x30,0x50,0x11,0x31,0x51,0x12,0x32,
 110                               0x52,0x13,0x33,0x53,0x14,0x34,0x54,
 111                               0
 112                          };    
 113          */
 114          code unsigned char slot[64]={0x00,0x07,0x0e,0x01,0x08,0x0f,0x02,
 115                               0x09,0x10,0x03,0x0a,0x11,0x04,0x0b,
 116                               0x12,0x05,0x0c,0x13,0x06,0x0d,0x14,
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 3   

 117          
 118                               0x20,0x27,0x2e,0x21,0x28,0x2f,0x22,
 119                               0x29,0x30,0x23,0x2a,0x31,0x24,0x2b,
 120                               0x32,0x25,0x2c,0x33,0x26,0x2d,0x34,
 121          
 122                               0x40,0x47,0x4e,0x41,0x48,0x4f,0x42,
 123                               0x49,0x50,0x43,0x4a,0x51,0x44,0x4b,
 124                               0x52,0x45,0x4c,0x53,0x46,0x4d,0x54,
 125                               0
 126                          };
 127          
 128              
 129          static void writeTxJ2(char chip, char witchJ2, char Slot, char j2, char busB)
 130          {
 131   1        int copOk = 0;
 132   1        int busBase = A_BUS_BASE;
 133   1        int i = 5;
 134   1        if(busB)
 135   1          busBase = B_BUS_BASE;
 136   1        // write  Tx J2 data
 137   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_TX_DATA_REG(busBase)] = j2;
 138   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_TX_WHICH_REG(busBase)] = witchJ2;
 139   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_TX_SLOT_REG(busBase)] = RW_SEL | Slot;
 140   1        while(!copOk){
 141   2          copOk = XBYTE[SW1021_CHIP_ADDR(chip) + J2_TX_RAM_STATUS_REG(busBase)] & 0x01;
 142   2          i--;
 143   2          if(i == 0)
 144   2            break;
 145   2          //Delay(1);
 146   2        }
 147   1      }
 148          
 149          static void writeExpectJ2(char chip, char witchJ2, char Slot, char j2, char busB)
 150          {
 151   1        int copOk = 0;
 152   1        int busBase = A_BUS_BASE;
 153   1        int i = 5;
 154   1        if(busB) 
 155   1          busBase = B_BUS_BASE;
 156   1        // write  Tx J2 data
 157   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_RX_DATA_REG(busBase)] = j2;
 158   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_RX_J2TYPE_CTRL_REG(busBase)] = EXPECT_J2 |  witchJ2;
 159   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_RX_CTRL_REG(busBase)] = RW_SEL | Slot;
 160   1        while(!copOk){
 161   2          copOk = XBYTE[SW1021_CHIP_ADDR(chip) + J2_RAM_STATUS_REG(busBase)] & READY;
 162   2          i--;
 163   2          if(i == 0)
 164   2            break;
 165   2          //Delay(1);
 166   2        }
 167   1      }
 168          
 169          /*****************************************************************
 170          ** º¯ÊýÃû:GETDATA
 171          ** Êä¡¡Èë: ÎÞ
 172          ** Êä¡¡³ö: ÎÞ
 173          ** ¹¦ÄÜÃèÊö£º²É¼¯µ¥ÅÌ¸æ¾¯ºÍÐÔÄÜ
 174          ** È«¾Ö±äÁ¿£ºÎÞ
 175          ** µ÷ÓÃÄ£¿é£ºÎÞ
 176          ** ×÷¡¡Õß£ºÎÌÒæêÍ
 177          ** ÈÕ¡¡ÆÚ£º2002.5.25
 178          ** ÐÞ¡¡¸Ä£º
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 4   

 179          ** ÈÕ¡¡ÆÚ£º
 180          ** °æ  ±¾£º1.0
 181          ****************************************************************/
 182          void GetData()          
 183          {
 184   1        unsigned char i,m,n,mi,ni,tmp,tmpi,ADCLK,PPILOS,TULOP,LPSLM,LPTIM,LPTIU,LPRDI,LPRFI,LPUNEQ,TUAIS,PPIAIS,
 185   1        LOOP,LOOPL,tv5;
 186   1        unsigned int  LPFEBE,HDB3;
 187   1        actnumber=0;
 188   1        almnumber=0;
 189   1        sw1021Chip = SW1021;
 190   1        for(i=0;i<(LINENUM-1);i++)
 191   1        {          
 192   2          
 193   2          if(g_ucState[78+i]==0)
 194   2          {
 195   3            g_ucLineMask[i]=1;
 196   3            // ADCLK ¸æ¾¯ (A Â·ÏÂÐÐÊ±ÖÓ¸æ¾¯ )
 197   3            ADCLK=XBYTE[sw1021Chip+E1_IF_STATUS_REG] & ADLOC; 
 198   3      
 199   3          }
 200   2          else   
 201   2          {
 202   3            m=i/21;
 203   3            n=i%21;
 204   3            mi=i/8;
 205   3            ni=i%8;
 206   3            
 207   3            sw1021Chip = SW1021_CHIP_ADDR(m);
 208   3            
 209   3            if(TULOP||TUAIS)
 210   3              g_ucLofFlag[i]=1;      //ÓÐTULOP,TUAIS,PPILOS¸æ¾¯Ö®Ò»Ê±ÉÏ±¨UAS
 211   3            else
 212   3              g_ucLofFlag[i]=0;
 213   3            
 214   3            actnumber=actnumber+g_ucConfData[64+i];
 215   3            
 216   3            ADCLK = XBYTE[sw1021Chip+E1_IF_STATUS_REG] & ADLOC;
 217   3            tmp = XBYTE[sw1021Chip+PORT_E1_ALARM_REG(n)];
 218   3            PPIAIS = tmp & E1AIS;
 219   3            PPILOS = tmp & E1LOS;
 220   3          /*
 221   3            tmp = XBYTE[sw1021Chip+TU12_J2_STATUS_REG2(A_BUS_BASE, n)];
 222   3            TULOP = tmp & LOPI;
 223   3            TUAIS = tmp & AISI;
 224   3            LPSLM = tmp & PLMI;
 225   3            LPTIM = tmp & RTIMI;
 226   3            LPTIU = tmp & RTIUI;
 227   3            LPRDI = tmp & RDII;
 228   3            LPRFI = tmp & RFII;
 229   3            LPUNEQ = tmp & UNEQI;
 230   3          */
 231   3            
 232   3            tmpi = XBYTE[sw1021Chip+TU12_J2_STATUS_REG2(A_BUS_BASE, n)];
 233   3            tmp = XBYTE[sw1021Chip+TU12_J2_STATUS_REG(A_BUS_BASE, n)] | tmpi;
 234   3            TULOP = tmp & LOPV;
 235   3            TUAIS = tmp & AISV;
 236   3            LPSLM = tmp & PLMV;
 237   3            LPTIM = tmp & RTIMV;
 238   3            LPTIU = tmp & RTIUV;
 239   3            LPRDI = tmp & RDIV;
 240   3            LPRFI = tmp & RFIV;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 5   

 241   3            LPUNEQ = tmp & UNEQV;
 242   3          #ifdef AIS_CONDITIONS 
 243   3            //AIS ²úÉúÌõ¼þ ---add by caijun.Li
 244   3            if(((g_ucConfData[2531] & 0x80) && LPTIM) || ((g_ucConfData[2531] & 0x40) && LPUNEQ ) || ((g_ucConfData
             -[2531] & 0x20) && LPSLM ) /* || ((g_ucConfData[2531] & 0x10) && LPSD )*/ ){
 245   4              // ÏÂ²åAIS
 246   4              XBYTE[sw1021Chip + PORT_CFG_REG(n)] |= RAISEN;
 247   4            }else{
 248   4              // Í£Ö¹ÏÂ²åAIS
 249   4              XBYTE[sw1021Chip + PORT_CFG_REG(n)] &= ~RAISEN;
 250   4            }
 251   3            
 252   3            #endif
 253   3            
 254   3            
 255   3            //must be write BIPERR_COUNTER_REG ; see manual
 256   3            XBYTE[sw1021Chip+BIPERR_COUNTER_REG(A_BUS_BASE, n)] = 0x00;
 257   3            g_liError1s[i].ulDatlong += XBYTE[sw1021Chip+BIPERR_COUNTER_REG(A_BUS_BASE, n)] + (XBYTE[sw1021Chip+BIP
             -ERR_COUNTER_REG(A_BUS_BASE, n) + 1] * 256);   // BIP´íÎó¼ÆÊýÖµ
 258   3            //must be write REI_COUNTER_REG ; see manual
 259   3            XBYTE[sw1021Chip+REI_COUNTER_REG(A_BUS_BASE, n)] = 0x00;
 260   3            LPFEBE = XBYTE[sw1021Chip+REI_COUNTER_REG(A_BUS_BASE, n)] + (XBYTE[sw1021Chip+REI_COUNTER_REG(A_BUS_BAS
             -E, n) + 1] * 256); //REI(FEBE)¼ÆÊýÖµ
 261   3            
 262   3            tmp = XBYTE[sw1021Chip + PORT_TEST_REG(n)];
 263   3                  
 264   3            LOOPL =  tmp & E1LBK;
 265   3            LOOP =   tmp & LnLBK;
 266   3            
 267   3            if((g_ucConfData[200+mi]&(0x01<<ni))==0)
 268   3            {
 269   4              g_stuAlm[i*(ALMTYPENUM-3)+6].ucState=0;
 270   4              if(PPILOS) g_stuAlm[i*(ALMTYPENUM-3)].ucState=1;           
 271   4              else                                              //E1ÊäÈë¿ÚÓÐÐÅºÅÊ±/// 
 272   4              {
 273   5                if(g_stuAlm[i*(ALMTYPENUM-3)].ucState==1)  //Èç¹û»¹´æÔÚPPILOS¸æ¾¯//
 274   5                if(WP==1)                        //·Ç±£»¤ÅÌÎ»Ê±//
 275   5                {
 276   6                  // ÏòµÚiÍ¨µÀÉÏ»°·½Ïò²å¶ÌÊ±¼äµÄÎ±Ëæ»úÂë
 277   6                  XBYTE[sw1021Chip + PORT_TEST_REG(n)] |= PRBSEN | PRBST;
 278   6                  g_stuAlm[i*(ALMTYPENUM-3)].ucState=0;//²»¸æPPILOS//
 279   6          
 280   6                  Delay(10);
 281   6                  XBYTE[sw1021Chip + PORT_TEST_REG(n)] &=  ~(PRBSEN | PRBST); //Í£²åÎ±Ëæ»úÂë
 282   6      
 283   6                }
 284   5                else g_stuAlm[i*(ALMTYPENUM-3)].ucState=0;//²»¸æPPILOS////±£»¤ÅÌÎ»Ê±//
 285   5              }
 286   4      
 287   4            }
 288   3            else
 289   3            {
 290   4              g_stuAlm[i*(ALMTYPENUM-3)].ucState=0;
 291   4              if(PPILOS) g_stuAlm[i*(ALMTYPENUM-3)+6].ucState=0;               
 292   4              else  g_stuAlm[i*(ALMTYPENUM-3)+6].ucState=1;
 293   4            }              
 294   3            //if(PPIAIS) g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;               
 295   3            //else g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 296   3            if(TULOP) g_stuAlm[i*(ALMTYPENUM-3)+1].ucState=1;              
 297   3            else g_stuAlm[i*(ALMTYPENUM-3)+1].ucState=0;  
 298   3            if(TUAIS) g_stuAlm[i*(ALMTYPENUM-3)+5].ucState=1;              
 299   3            else g_stuAlm[i*(ALMTYPENUM-3)+5].ucState=0;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 6   

 300   3            if(TULOP||TUAIS)
 301   3            {
 302   4              g_stuAlm[i*(ALMTYPENUM-3)+2].ucState=0;
 303   4              g_stuAlm[i*(ALMTYPENUM-3)+3].ucState=0;
 304   4              g_stuAlm[i*(ALMTYPENUM-3)+4].ucState=0;
 305   4              #ifdef NEED_LP_RFI
                      g_stuAlm[i*(ALMTYPENUM-3)+15].ucState=0; 
                      #endif
 308   4              g_stuAlm[i*(ALMTYPENUM-3)+9].ucState=0; 
 309   4            }
 310   3            else
 311   3            {
 312   4              if(LPSLM) g_stuAlm[i*(ALMTYPENUM-3)+2].ucState=1;              
 313   4              else g_stuAlm[i*(ALMTYPENUM-3)+2].ucState=0;
 314   4              if(LPRDI) g_stuAlm[i*(ALMTYPENUM-3)+3].ucState=1;              
 315   4              else g_stuAlm[i*(ALMTYPENUM-3)+3].ucState=0;
 316   4              if(LPUNEQ) g_stuAlm[i*(ALMTYPENUM-3)+4].ucState=1;               
 317   4              else g_stuAlm[i*(ALMTYPENUM-3)+4].ucState=0;
 318   4      
 319   4              /* ·é»ðÀÏÉè±¸Î´Ê¹ÓÃRFI,²»Ê¹ÓÃÊ±½«ÏÂÃæÁ½¾äÆÁ±Î */
 320   4      #ifdef NEED_LP_RFI
                       if(LPRFI) g_stuAlm[i*(ALMTYPENUM-3)+15].ucState=1;              
                       else g_stuAlm[i*(ALMTYPENUM-3)+15].ucState=0; 
              #endif
 324   4              
 325   4              if(LPTIM) g_stuAlm[i*(ALMTYPENUM-3)+9].ucState=1;              
 326   4              else g_stuAlm[i*(ALMTYPENUM-3)+9].ucState=0;  
 327   4            }
 328   3            if(LOOPL) g_stuAlm[i*(ALMTYPENUM-3)+10].ucState=1;               
 329   3            else g_stuAlm[i*(ALMTYPENUM-3)+10].ucState=0;
 330   3            if(LOOP) g_stuAlm[i*(ALMTYPENUM-3)+11].ucState=1;              
 331   3            else g_stuAlm[i*(ALMTYPENUM-3)+11].ucState=0;
 332   3            if(g_stuPm[i*PMTYPENUM+3].Value.usint>=(0xffff-LPFEBE)) g_stuPm[i*PMTYPENUM+3].Value.usint=0xffff;     
             -  
 333   3            else g_stuPm[i*PMTYPENUM+3].Value.usint+=LPFEBE;   //REI(FEBE)ÐÔÄÜÖµ                    
 334   3            if(g_stuAlm[i*(ALMTYPENUM-3)].ucState==0)                               //ÎÞPPI_LOS¸æ¾¯Ê±
 335   3            {
 336   4               //HDB3±àÂëÎ¥Àý¼ÆÊýÖµ
 337   4              HDB3 = XBYTE[sw1021Chip + HDB3_CV_REG(n)];
 338   4              
 339   4              if(g_stuPm[i*PMTYPENUM+4].Value.usint>=(0xffff-HDB3)) g_stuPm[i*PMTYPENUM+4].Value.usint=0xffff;     
 340   4              else g_stuPm[i*PMTYPENUM+4].Value.usint+=HDB3;      // HDB3ÐÔÄÜÖµ         //g_stuPm[i][4]=HDB3CV
 341   4            }           
 342   3      
 343   3            if(g_stuAlm[i*(ALMTYPENUM-3)+1].ucState||g_stuAlm[i*(ALMTYPENUM-3)+5].ucState)
 344   3            almnumber=almnumber+1;
 345   3            
 346   3            tv5 = XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)];
 347   3            if(g_stuAlm[i*(ALMTYPENUM-3)+1].ucState||g_stuAlm[i*(ALMTYPENUM-3)+5].ucState||g_stuAlm[i*(ALMTYPENUM-3
             -)+4].ucState)
 348   3            { //Èç¹ûTUAIS,TULOP,LPUNEQÖ®Ò»Îª"1" ÔòÏòÉÏ²åVC12=AIS,LPRDI,ÏòÏÂ²åAIS
 349   4                if((tv5 & RDI_CNF) != RDI_CNF)
 350   4                  XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)] = tv5 | RDI_CNF;
 351   4            }
 352   3            else
 353   3            {
 354   4              if((tv5 & RDI_CNF) == RDI_CNF)
 355   4                XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)] = tv5 & (~RDI_CNF);
 356   4            }
 357   3          }
 358   2        }
 359   1        
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 7   

 360   1        for(i=0;i<(LINENUM-1);i++)
 361   1        {
 362   2          m=i/21;
 363   2          n=i%21;
 364   2          sw1021Chip = SW1021_CHIP_ADDR(m);
 365   2          // »ñÈ¡N2 ºÍ K4 Öµ
 366   2          //TODO: get N2
 367   2          //g_ucState[204+2*i]=XBYTE[WGS21891+0x0100+0x10*n+0x0C]; 
 368   2          g_ucState[205+2*i]=XBYTE[sw1021Chip + RX_K4_REG(A_BUS_BASE,n)];
 369   2          
 370   2          
 371   2          mi=i/8;
 372   2          ni=i%8;
 373   2          if((g_ucConfData[200+mi]&(0x01<<ni))==0)
 374   2            g_ucState[330+mi]&=(~(0x01<<ni));
 375   2      
 376   2          else
 377   2            g_ucState[330+mi]|=(0x01<<ni);    
 378   2      
 379   2          //  tv5=XBYTE[WGS21891+0x0100+0x10*n+0x00];
 380   2      
 381   2        }
 382   1      
 383   1         
 384   1      
 385   1        if(TUXAB) g_ucState[77]=0;
 386   1        else g_ucState[77]=1;
 387   1                           
 388   1             
 389   1        if((WP==0) &&(TUSWTI==0))  //±£»¤ÅÌÎ»Ê±,Èç¹ûÃ»ÓÐµ¹»»ACTµÆÂýÉÁ//     
 390   1        {
 391   2          g_ucState[76]=0;
 392   2          g_LampEn=0;        
 393   2          if(g_stuSysClock.ucSecond%2==0) ACT=ON;
 394   2          else ACT=OFF;
 395   2          for(i=0;i<(LINENUM-1);i++)
 396   2          {
 397   3            g_ucLineMask[i]=1;
 398   3            g_ucState[141+i]=1;
 399   3          }
 400   2        }
 401   1        else if(g_ucState[76]==0)
 402   1        {                           
 403   2          for(i=0;i<(LINENUM-1);i++)
 404   2          {
 405   3            if((g_ucConfData[64+i]==0)||(g_ucConfData[137+i]==01))
 406   3            {    
 407   4              g_ucLineMask[i]=1;
 408   4              g_ucState[141+i]=1;  
 409   4            }   
 410   3            else
 411   3            {
 412   4              g_ucLineMask[i]=0;  
 413   4              g_ucState[141+i]=0;
 414   4            }
 415   3          }
 416   2          g_ucState[76]=1;     
 417   2          g_LampEn=1;
 418   2          WROUTPORT;           
 419   2        }
 420   1             
 421   1        UasClear();
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 8   

 422   1      
 423   1      
 424   1        if(g_AllClrFlag)                //ÇåÐÔÄÜ
 425   1        {   
 426   2          g_bClearUas=1; 
 427   2          g_AllClrFlag=0;
 428   2        }
 429   1      
 430   1        if(g_SecondFlag)                   //Ãë±êÊ¶£¬1£º½øÈëÐÂµÄÒ»Ãë
 431   1        {
 432   2          CalUas(ulSesLmt);           //uas¼ÆËã        
 433   2      
 434   2          for(i=0; i<(LINENUM-1); i++)
 435   2          {
 436   3            g_stuPm[i*PMTYPENUM].Value.usint=g_usiBbe[i];         //bbe_lpÐÔÄÜµÄ²É¼¯
 437   3            g_stuPm[i*PMTYPENUM+1].Value.usint=g_usiEs[i];        //es_lpÐÔÄÜµÄ²É¼¯
 438   3            g_stuPm[i*PMTYPENUM+2].Value.usint=g_usiSes[i];       //ses_lpÐÔÄÜµÄ²É¼¯
 439   3            if(g_usiEs[i]>=ulEsLimit) 
 440   3              g_stuAlm[i*(ALMTYPENUM-3)+7].ucState=1;    //curalm[i][8]=es_limit
 441   3            else 
 442   3              g_stuAlm[i*(ALMTYPENUM-3)+7].ucState=0;
 443   3            // if(g_usiSes[i]>=ulSesLimit) g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;    //curalm[i][9]=ses_limit
 444   3            // else g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 445   3            g_stuPm[i*PMTYPENUM+5].Value.usint=g_usiUas[i];             //UAS_LPÐÔÄÜµÄ²É¼¯
 446   3            g_stuPm[i*PMTYPENUM+6].Value.usint=g_usiCses[i];            //cses_lpÐÔÄÜµÄ²É¼¯
 447   3      
 448   3      
 449   3            /******************************************************************************/
 450   3            if(g_stuAlm[i*(ALMTYPENUM-3)+5].ucState||g_stuAlm[i*(ALMTYPENUM-3)+1].ucState)
 451   3            {
 452   4              g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 453   4              BIP[i]=0;
 454   4            }
 455   3            else
 456   3            {
 457   4              BIP_2_1S[i]=BIP[i];
 458   4              BIP_2_1000S[i]+=BIP[i];  
 459   4              BIP[i]=0;
 460   4              switch(g_ucConfData[129])
 461   4              {
 462   5                case 0x04:
 463   5                if(BIP_2_1S[i]>=217) 
 464   5                  g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 465   5                else if(BIP_2_1S[i]<=23) 
 466   5                  g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 467   5                break;
 468   5      
 469   5                case 0x05:
 470   5                if(BIP_2_1S[i]>=22) 
 471   5                  g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 472   5                else if(BIP_2_1S[i]<=3) 
 473   5                  g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 474   5                break;
 475   5      
 476   5                case 0x06:
 477   5      
 478   5      
 479   5                if((N1000[i]>=10)&&(N1000[i]<100))
 480   5                {
 481   6                  if(BIP_2_1000S[i]>=22) 
 482   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 483   6                  else if(BIP_2_1000S[i]<=3) 
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 9   

 484   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 485   6                  N1000[i]=0;
 486   6                  BIP_2_1000S[i]=0;
 487   6                }
 488   5                else N1000[i]++;
 489   5      
 490   5                break;
 491   5      
 492   5                case 0x07:
 493   5      
 494   5      
 495   5                if((N1000[i]>=100)&&(N1000[i]<1000))
 496   5                {
 497   6                  if(BIP_2_1000S[i]>=22) 
 498   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 499   6                  else if(BIP_2_1000S[i]<=3) 
 500   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 501   6                  N1000[i]=0;
 502   6                  BIP_2_1000S[i]=0;
 503   6                }
 504   5                else N1000[i]++;
 505   5                break;
 506   5      
 507   5                case 0x08:
 508   5      
 509   5      
 510   5                if(N1000[i]>=1000)
 511   5                {
 512   6                  if(BIP_2_1000S[i]>=22) 
 513   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 514   6                  else if(BIP_2_1000S[i]<=3) 
 515   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 516   6                  N1000[i]=0;
 517   6                  BIP_2_1000S[i]=0;
 518   6                }
 519   5                else 
 520   5                  N1000[i]++;
 521   5                break;
 522   5              }
 523   4            }
 524   3      
 525   3          /********************************************************************************/
 526   3      
 527   3          }
 528   2      
 529   2          g_SecondFlag=0;      //Ãë±êÊ¶Çå?
 530   2      
 531   2        }     
 532   1      
 533   1        //IO8=1;
 534   1        // WRHIO;
 535   1        //RDHIO;    
 536   1        //IO9=1;
 537   1        // WRHIO;
 538   1        //RDHIO;
 539   1        //IO10=1;
 540   1        // WRHIO;
 541   1        //RDHIO;
 542   1        //IO11=1;
 543   1        // WRHIO;
 544   1        //RDHIO;
 545   1        //IO12=1;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 10  

 546   1        // WRHIO;
 547   1        RDHIO;
 548   1      
 549   1         
 550   1             
 551   1        if(ADCLK||(P2V5==0)||(first_conf==0)) 
 552   1          TUALMO=1; //Èç¹û¹¤×÷Ö§Â·ÖÐÈ«²¿ÓÐ¸æ¾¯»ò2.5V//
 553   1        else 
 554   1          TUALMO=0; //µçÔ´ÓÐ¸æ¾¯»òÏÂÅäÖÃÇ°TUALMO=1,·ñÔòTUALMO=0//
 555   1        if((P5VI1==0)&&(DZBI1==0)) 
 556   1          g_stuAlm[63*(ALMTYPENUM-3)+1].ucState=1;
 557   1        else    
 558   1          g_stuAlm[63*(ALMTYPENUM-3)+1].ucState=0;               
 559   1        if((P5VI2==0)&&(DZBI2==0)) 
 560   1          g_stuAlm[63*(ALMTYPENUM-3)+2].ucState=1;
 561   1        else    
 562   1          g_stuAlm[63*(ALMTYPENUM-3)+2].ucState=0;       
 563   1        if(P2V5==0) 
 564   1          g_stuAlm[63*(ALMTYPENUM-3)+0].ucState=1;
 565   1        else    
 566   1          g_stuAlm[63*(ALMTYPENUM-3)+0].ucState=0;                     
 567   1       
 568   1      }
 569          
 570          /*****************************************************************
 571          ** º¯ÊýÃû:USERFUN
 572          ** Êä¡¡Èë: ÎÞ
 573          ** Êä¡¡³ö: ÎÞ
 574          ** ¹¦ÄÜÃèÊö£ºÓÃ»§ÊµÊ±´¦Àíº¯Êý£¬10ºÁÃë±»µ÷ÓÃÒ»´Î
 575          ** È«¾Ö±äÁ¿£ºÎÞ
 576          ** µ÷ÓÃÄ£¿é£ºÎÞ
 577          ** ×÷¡¡Õß£ºÎÌÒæêÍ
 578          ** ÈÕ¡¡ÆÚ£º2002.5.25
 579          ** ÐÞ¡¡¸Ä£º
 580          ** ÈÕ¡¡ÆÚ£º
 581          ** °æ  ±¾£º1.0
 582          ****************************************************************/
 583          
 584          void UserFunc() using 1
 585          {
 586   1        return;
 587   1      }
 588          
 589          /*****************************************************************
 590          ** º¯ÊýÃû:CONF_SET
 591          ** Êä¡¡Èë: ÎÞ
 592          ** Êä¡¡³ö: ÎÞ
 593          ** ¹¦ÄÜÃèÊö£ºµ¥ÅÌÅäÖÃ
 594          ** È«¾Ö±äÁ¿£ºÎÞ
 595          ** µ÷ÓÃÄ£¿é£ºÎÞ
 596          ** ×÷¡¡Õß£ºcaijun.Li
 597          ** ÈÕ¡¡ÆÚ£º2016.3.19
 598          ** ÐÞ¡¡¸Ä£º
 599          ** ÈÕ¡¡ÆÚ£º
 600          ** °æ  ±¾£º1.0
 601          ****************************************************************/
 602          void ConfSet(void)
 603          {
 604   1          /*Process ALMMASK*/
 605   1          /*Process PMMASK*/
 606   1        unsigned char i,j,ilong,m,n,temp;
 607   1      
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 11  

 608   1        g_ucState[69]=g_ucConfData[5];
 609   1        g_ucState[70]=g_ucConfData[6];
 610   1        g_ucState[71]=g_ucConfData[7];
 611   1        g_ucState[72]=g_ucConfData[8];
 612   1        g_ucState[73]=g_ucConfData[9];
 613   1        g_ucState[74]=g_ucConfData[10];
 614   1        g_ucState[75]=g_ucConfData[11];
 615   1        for(i=0;i<(LINENUM-1);i++){
 616   2          m=i/21;
 617   2          n=i%21;
 618   2          sw1021Chip = SW1021_CHIP_ADDR(m);
 619   2        
 620   2          XBYTE[sw1021Chip + RXTU12_SLOT_REG(A_BUS_BASE,n)] = slot[i];  
 621   2          XBYTE[sw1021Chip + TXTU12_SLOT_REG(A_BUS_BASE,n)] = slot[i];  
 622   2          XBYTE[sw1021Chip + RXTU12_SLOT_REG(B_BUS_BASE,n)] = slot[i];  
 623   2          XBYTE[sw1021Chip + TXTU12_SLOT_REG(B_BUS_BASE,n)] = slot[i];  
 624   2      
 625   2          if(g_ucConfData[64+i]==0){  // Ö§Â·¹Ø±Õ
 626   3            // ÉÏÏÂ»°Ç¿·¢AIS
 627   3            //XBYTE[sw1021Chip + TX_CTRL_REG(B_BUS_BASE,n)] = AIS_EN; 
 628   3            temp = XBYTE[sw1021Chip + PORT_CFG_REG(n)];
 629   3            XBYTE[sw1021Chip + PORT_CFG_REG(n)] = temp | TAISEN | RAISEN; 
 630   3            XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)] = 0x00;
 631   3                  
 632   3            g_ucState[78+i]=0;     
 633   3            g_ucLineMask[i]=1;
 634   3            g_ucState[141+i]=1;
 635   3          }else{  // Ö§Â·´ò¿ª
 636   3            XBYTE[sw1021Chip + PORT_CFG_REG(n)] = A_UP_DOWN | RnEN;
 637   3            XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)] = (0x02 << 1);  // ×¢ÒâÐÅºÅ±ê¼ÇÖµµÃÅäÖÃ
 638   3            if(g_ucState[78+i]==0)//¸Õ´ò¿ªÖ§Â·¿ª¹ØÊ±²åÎ±Ëæ»úÂë
 639   3            {
 640   4              //TODO: Æô¶¯ÎóÂë¼ÆÊýÆ÷
 641   4              XBYTE[sw1021Chip + PORT_TEST_REG(n)] |= PRBSEN | PRBST;
 642   4              Delay(5);
 643   4              XBYTE[sw1021Chip + PORT_TEST_REG(n)] &= ~(PRBSEN | PRBST);
 644   4              g_ucState[78+i]=1;
 645   4              g_ucLineMask[i]=0; 
 646   4              g_ucState[141+i]=0;
 647   4            }         
 648   3          }
 649   2          XBYTE[sw1021Chip + TX_K4_REG(A_BUS_BASE,n)]= g_ucConfData[263+4*i+2];               // K4 ·¢ 
 650   2          XBYTE[sw1021Chip + TX_K4_REG(B_BUS_BASE,n)]= g_ucConfData[263+4*i+2];               // K4 ·¢ 
 651   2          // TODO: N2 ·¢
 652   2          //XBYTE[WGS21891+0x0100+0x10*n+0x01]=g_ucConfData[263+4*i];                 // N2 ·¢
 653   2        
 654   2          // J2 ·¢ ºÍ ÆÚÍûÊÕ
 655   2          for(j=0;j<16;j++)
 656   2          {
 657   3            if(j==0) temp=0x80;
 658   3            else temp=0;
 659   3            
 660   3            // A 
 661   3            writeTxJ2(m, j, slot[i],  temp|g_ucConfData[515+2*i*16+j], 0);
 662   3            writeExpectJ2(m, j, slot[i],  temp|g_ucConfData[515+16+2*i*16+j], 0);
 663   3            // B
 664   3            writeTxJ2(m, j, slot[i],  temp|g_ucConfData[515+2*i*16+j], 1);
 665   3            writeExpectJ2(m, j, slot[i],  temp|g_ucConfData[515+16+2*i*16+j], 1);
 666   3          }
 667   2          
 668   2          if(g_ucConfData[137+i]==0)   //confdata[137+i]==0²»ÆÁ±ÎÖ§Â·i¸æ¾¯/·ñÔòÆÁ±ÎÖ§Â·i¸æ¾¯//
 669   2          {
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 12  

 670   3            g_ucLineMask[i]=0;
 671   3            g_ucState[141+i]=0;
 672   3          }
 673   2          else
 674   2          {
 675   3            g_ucLineMask[i]=1;
 676   3            g_ucState[141+i]=1;
 677   3          }
 678   2        //if(g_ucConfData[200+i]==0)     //confdata[200+i]==1Ö§Â·i×°ÔØ/·ñÔò²»×°ÔØ//
 679   2        //XBYTE[WGS21891+0x0100+0x10*n+0x00]=0x00;
 680   2        // else  XBYTE[WGS21891+0x0100+0x10*n+0x00]=0x04;
 681   2      
 682   2        }
 683   1      
 684   1      
 685   1      
 686   1        for(j=0;j<ALMTYPENUM;j++) 
 687   1        {
 688   2           
 689   2           for(ilong=29;ilong<(29+ALMTYPENUM);ilong++)
 690   2           {    
 691   3              if(g_ucConfData[ilong]==g_ucAlmCode[j])   //´ÓÍø¹ÜÉè¸æ¾¯ÆÁ±Î//
 692   3              {
 693   4               g_ucAlmMask[j]=1;                              
 694   4               break;     
 695   4              }
 696   3              else
 697   3              g_ucAlmMask[j]=0;
 698   3      
 699   3           }
 700   2        }      
 701   1                          
 702   1        for(j=0;j<PMTYPENUM;j++)  
 703   1        {
 704   2      
 705   2          for(ilong=54;ilong<(54+PMTYPENUM);ilong++)
 706   2          {   
 707   3            if(g_ucConfData[ilong]==g_ucPmCode[j])   //´ÓÍø¹ÜÉèÐÔÄÜÆÁ±Î//
 708   3            {
 709   4              g_ucPmMask[j]=1;                              
 710   4              break;    
 711   4            }
 712   3            else
 713   3              g_ucPmMask[j]=0;
 714   3          }
 715   2        }        
 716   1      
 717   1        ulEsLimit=256*g_ucConfData[131]+g_ucConfData[132];    //´ÓÍø¹ÜÉèulEsLimitÃÅÏÞ//
 718   1        ulSesLimit=256*g_ucConfData[134]+g_ucConfData[135];   //´ÓÍø¹ÜÉèulSesLimitÃÅÏÞ//
 719   1      
 720   1        //if((g_ucConfData[136]==0)&&TUALMO&&WP) TUALMO=0;  //IO2=TUALMO  confdata[108]=ÅÌ±£»¤Ä£Ê½²»±£»¤
 721   1      
 722   1      
 723   1        // g_ucConfChange=0;                          
 724   1              
 725   1      
 726   1        if(first_conf==0) first_conf=1; 
 727   1      }
 728          
 729          
 730          /*****************************************************************
 731          ** º¯ÊýÃû:UserHdlc
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 13  

 732          ** Êä¡¡Èë: ÎÞ
 733          ** Êä¡¡³ö: ÎÞ
 734          ** ¹¦ÄÜÃèÊö£ºµ¥ÅÌÌØÊâÃüÁî´¦Àí
 735          ** È«¾Ö±äÁ¿£ºÎÞ
 736          ** µ÷ÓÃÄ£¿é£ºÎÞ
 737          ** ×÷¡¡Õß£ºcaijun.Li
 738          ** ÈÕ¡¡ÆÚ£º2016.3.19
 739          ** ÐÞ¡¡¸Ä£º
 740          ** ÈÕ¡¡ÆÚ£º
 741          ** °æ  ±¾£º1.0
 742          ****************************************************************/
 743          void UserHdlc(void)
 744          {
 745   1        unsigned char i,m,n,temp;
 746   1        unsigned int addr;
 747   1      
 748   1        if (g_ucHdlcBuf[CMD_TYPE]==COMM_CATA)
 749   1        {
 750   2          if (g_ucHdlcBuf[CMD_CODE]==RTRV_OCONF)
 751   2          {
 752   3            g_ucHdlcBuf[CHARACTER1]=CMD_RIGHT;
 753   3          }
 754   2          else if (g_ucHdlcBuf[CMD_CODE]==SET_OCONF)
 755   2          {
 756   3            g_ucHdlcBuf[CHARACTER1]=CMD_RIGHT;                                               
 757   3          }
 758   2        }
 759   1      
 760   1      
 761   1        switch(g_ucHdlcBuf[5])
 762   1        {
 763   2          case 0x00:    /*SET_LOOP*/
 764   2            if(g_ucHdlcBuf[6]==0x34)
 765   2            { // Éè±¸»·»Ø
 766   3              if(((g_usRxDataLen)==0)||((g_usRxDataLen)>63)) 
 767   3                g_ucHdlcBuf[10]=0x80; 
 768   3              else                
 769   3                for(i=0;i<(g_usRxDataLen);i++)
 770   3                {
 771   4                  temp=g_ucHdlcBuf[14+i]-1;
 772   4                  m=temp/21;
 773   4                  n=temp%21;
 774   4      
 775   4                  sw1021Chip = SW1021_CHIP_ADDR(m);
 776   4                  if(g_ucHdlcBuf[7]==0x01){
 777   5                    XBYTE[sw1021Chip + PORT_TEST_REG(n)] |= LnLBK;
 778   5                  }else{
 779   5                    XBYTE[sw1021Chip + PORT_TEST_REG(n)] &= (~LnLBK);
 780   5                  }
 781   4                  g_ucHdlcBuf[10]=0x00;
 782   4                }
 783   3            }
 784   2            else if(g_ucHdlcBuf[6]==0x33)       /*SET_LOOPL*/
 785   2            { // ÏßÂ·»·»Ø 
 786   3              if(((g_usRxDataLen)==0)||((g_usRxDataLen)>63)) 
 787   3                g_ucHdlcBuf[10]=0x80; 
 788   3              else                  
 789   3                for(i=0;i<(g_usRxDataLen);i++)
 790   3                {
 791   4                  temp=g_ucHdlcBuf[14+i]-1;
 792   4                  m=temp/21;
 793   4                  n=temp%21;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 14  

 794   4                  
 795   4                  sw1021Chip = SW1021_CHIP_ADDR(m);
 796   4                  if(g_ucHdlcBuf[7]==0x01){
 797   5                    XBYTE[sw1021Chip + PORT_TEST_REG(n)] |= E1LBK;
 798   5                  }else{
 799   5                    XBYTE[sw1021Chip + PORT_TEST_REG(n)] &= (~E1LBK);
 800   5                  }
 801   4                  g_ucHdlcBuf[10]=0x00;
 802   4                }
 803   3            }
 804   2      
 805   2            break;
 806   2      
 807   2          case 0x77:                /**Í¸Ã÷Ö¡ÃüÁî**/
 808   2            addr=256*g_ucHdlcBuf[14]+g_ucHdlcBuf[15];  // commbuf[14]£¬commbuf[15]Ëù´æ·Å µÄ µØÖ·
 809   2            g_ucHdlcBuf[10]=0x00;
 810   2            g_ucHdlcBuf[11]=0x00;
 811   2            g_ucHdlcBuf[12]=0x00;
 812   2            g_ucHdlcBuf[13]=0x11;
 813   2            //¶Á16¸ö×Ö½Ú//  addr µØÖ·¿ªÊ¼¶ÁÈ¡16¸ö×Ö½ÚÊý¾Ý//
 814   2            for(i=0;i<16;i++) 
 815   2              g_ucHdlcBuf[14+i]=XBYTE[addr+i]; 
 816   2            g_ucHdlcBuf[30]=P1;
 817   2            break;                   
 818   2          
 819   2          case 0x88:
 820   2            addr=256*g_ucHdlcBuf[14]+g_ucHdlcBuf[15];
 821   2            XBYTE[addr]=g_ucHdlcBuf[16];       //½«commbuf[16]´æ·ÅµÄÊý¾ÝËÍÈëcommbuf[14]£¬//
 822   2            g_ucHdlcBuf[10]=0x00;              //commbuf[15]Ëù´æ·ÅµÄWGS21891µÄµØÖ·µ¥ÔªÖÐ//
 823   2            g_ucHdlcBuf[11]=0x00;
 824   2            g_ucHdlcBuf[12]=0x00;
 825   2            g_ucHdlcBuf[13]=0x10;              //¶Á16¸ö×Ö½Ú//
 826   2            for(i=0;i<16;i++) 
 827   2              g_ucHdlcBuf[14+i]=XBYTE[addr+i]; //´Ócommbuf[14]£¬commbuf[15]µÄµØÖ·¿ªÊ¼¶ÁÈ¡16¸ö×Ö½ÚÊý¾Ý//
 828   2            break;
 829   2      
 830   2          case 0X99:
 831   2            while(1)
 832   2            {;}
 833   2            if((g_usRxDataLen==0)||(g_usRxDataLen>63)) 
 834   2              g_ucHdlcBuf[10]=0x80; 
 835   2            else                
 836   2              for(i=0;i<(g_usRxDataLen);i++)
 837   2              {
 838   3                temp=g_ucHdlcBuf[14+i]-1;
 839   3                m=temp/21;
 840   3                n=temp%21;
 841   3                sw1021Chip = SW1021_CHIP_ADDR(m);
 842   3                          
 843   3                g_ucHdlcBuf[17]=XBYTE[sw1021Chip + PORT_TEST_REG(n)];
 844   3                g_ucHdlcBuf[18]=0xbb;
 845   3                
 846   3                if(g_ucHdlcBuf[7]==0x01)
 847   3                {
 848   4                  XBYTE[sw1021Chip + PORT_TEST_REG(n)] |= LnLBK;
 849   4                  if(n<8)
 850   4                    g_ucHdlcBuf[18]=0xff;
 851   4                }
 852   3                else
 853   3                {
 854   4                  XBYTE[sw1021Chip + PORT_TEST_REG(n)] &= (~LnLBK);
 855   4                }
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 15  

 856   3                    
 857   3              }
 858   2            g_ucHdlcBuf[10]=0x00;
 859   2            g_ucHdlcBuf[13]=6;
 860   2            g_ucHdlcBuf[14]=0xaa;
 861   2            g_ucHdlcBuf[15]=m;
 862   2            g_ucHdlcBuf[16]=n;
 863   2            g_ucHdlcBuf[19]=XBYTE[sw1021Chip + PORT_TEST_REG(n)];
 864   2            
 865   2            break;
 866   2            
 867   2      
 868   2        }
 869   1      
 870   1      }
 871          
 872          /*****************************************************************
 873          ** º¯ÊýÃû:SELF_CONF
 874          ** Êä¡¡Èë: ÎÞ
 875          ** Êä¡¡³ö: ÎÞ
 876          ** ¹¦ÄÜÃèÊö£ºµ¥ÅÌÉÏµçÄ¬ÈÏÅäÖÃ
 877          ** È«¾Ö±äÁ¿£ºg_ucConfData[]
 878          ** µ÷ÓÃÄ£¿é£ºÎÞ
 879          ** ×÷¡¡Õß£ºÎÌÒæêÍ
 880          ** ÈÕ¡¡ÆÚ£º2002.5.25
 881          ** ÐÞ¡¡¸Ä£º
 882          ** ÈÕ¡¡ÆÚ£º
 883          ** °æ  ±¾£º1.0
 884          ** ×¢  Òâ£ºËùÓÐ¸æ¾¯ºÍÐÔÄÜµÄ³õÊ¼»¯Ðè°²ÏßÂ·ºÅË³Ðò
 885          ****************************************************************/
 886          void SelfConf()
 887          {
 888   1      
 889   1        unsigned int i,j;
 890   1        char ctt[18];
 891   1        unsigned char ucii;
 892   1        //  first_conf=0;
 893   1        g_ucConfData[22]=BOARDCODE;/*BDINF5*/
 894   1        g_ucConfData[0]=0xfe;
 895   1      
 896   1      
 897   1        sprintf(ctt,BoardSn);
 898   1        for(ucii=0;ucii<15;ucii++) g_ucState[ucii]=ctt[ucii];  /*ÅÌºÅ*/
 899   1      
 900   1        sprintf(ctt,PcbSn);   
 901   1        for(ucii=0;ucii<15;ucii++) g_ucState[15+ucii]=ctt[ucii]; /*°åºÅ*/
 902   1      
 903   1        sprintf(ctt,PcbTime);   
 904   1        for(ucii=0;ucii<10;ucii++) g_ucState[30+ucii]=ctt[ucii]; /*ÖÆ°åÊ±¼ä*/
 905   1      
 906   1        for(ucii=0;ucii<18;ucii++) ctt[ucii]=0;    /*°æ±¾ºÅbufÇåÁã*/
 907   1        //sprintf(ctt,"R170609R1B/01F    "); 
 908   1        //for(ucii=0;ucii<18;ucii++) g_ucState[40+ucii]=ctt[ucii];
 909   1        sprintf(ctt,BoardSoftVer); 
 910   1        for(ucii=0;ucii<18;ucii++) g_ucState[40+ucii]=ctt[ucii];
 911   1        sprintf(ctt,__DATE__);   
 912   1        for(ucii=0;ucii<11;ucii++) g_ucState[58+ucii]=ctt[ucii]; /*±à³ÌÊ±¼ä*/
 913   1      
 914   1        //g_ucState[69]=0x07;
 915   1        //g_ucState[70]=0xD1;
 916   1        //g_ucState[71]=0x06;
 917   1        //g_ucState[72]=0x01;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 16  

 918   1        //g_ucState[73]=0x08;
 919   1        //g_ucState[74]=0x00;
 920   1        //g_ucState[75]=0x00;
 921   1        g_ucState[76]=0x01;
 922   1        //g_ucState[77]=0x01;
 923   1      
 924   1      
 925   1      
 926   1        for(i=0;i<LINENUM;i++)           /*linecode=1..63*/
 927   1          g_ucLineCode[i]=i+1;
 928   1        for(i=0;i<LINENUM;i++)
 929   1        {
 930   2          g_ucLineMask[i]=0;          
 931   2      
 932   2        }
 933   1      
 934   1      
 935   1      
 936   1        /*for(i=0;i<LINENUM;i++)
 937   1        for(j=0;j<PMNUM;j++) linepmmask[i][j]=0;*/         
 938   1      
 939   1      
 940   1        actnumber=63;             
 941   1        almnumber=0;     
 942   1      
 943   1        ulEsLimit=0xff;
 944   1        ulSesLimit=0xff;
 945   1      
 946   1        g_ucAlmCode[0]=0x03;                        /*PPI_LOS*/
 947   1        g_ucAlmCode[1]=0x27;                        /*TU_LOP*/
 948   1        g_ucAlmCode[2]=0x22;                        /*LP_SLM*/
 949   1        g_ucAlmCode[3]=0x20;                        /*LP_RDI*/
 950   1        g_ucAlmCode[4]=0x24;                        /*LP_UNEQ*/
 951   1        //g_ucAlmCode[8]=0x04;                        /*PPI_AIS*/
 952   1        g_ucAlmCode[5]=0x02;                        /*TU_AIS*/
 953   1      #ifdef NEED_LP_RFI
                g_ucAlmCode[15]=0x0c;                        /*LP_RFI*/
              #endif
 956   1        g_ucAlmCode[7]=0x51;                        /*ES_LIMIT*/
 957   1        //g_ucAlmCode[8]=0x52;      /*SES _LIMIT*/
 958   1        g_ucAlmCode[9]=0x28;                       /*LP_TIM*/
 959   1        g_ucAlmCode[10]=0x4f;                       /*LOOPL*/
 960   1        g_ucAlmCode[11]=0x55;     /*LOOP*/
 961   1        g_ucAlmCode[12]=0x01;                       //2V5µçÔ´¹ÊÕÏ¸æ¾¯//
 962   1        g_ucAlmCode[13]=0x05;                       //5VI1µçÔ´¹ÊÕÏ¸æ¾¯//
 963   1        g_ucAlmCode[14]=0x06;                       //5VI2µçÔ´¹ÊÕÏ¸æ¾¯//
 964   1        g_ucAlmCode[6]=0x07;                 //trafic-onload//
 965   1        g_ucAlmCode[8]=0x08;                /*LP_SD*/
 966   1      
 967   1        g_ucPmCode[0]=0x08;                   /*BBE_LP*/
 968   1        g_ucPmCode[1]=0x02;                   /*ES_LP*/
 969   1        g_ucPmCode[2]=0x03;                   /*SES_LP*/
 970   1        g_ucPmCode[3]=0x07;                   /*REI_LP*/
 971   1        g_ucPmCode[4]=0x0b;                   /*HDB3CV*/
 972   1        //g_ucPmCode[5]=0x06;                 /*UAS_LP*/
 973   1        g_ucPmCode[5]=0x0c;                   /*UAS_LP*/
 974   1        g_ucPmCode[6]=0xa2;                   /*CSES_LP*/
 975   1      
 976   1        g_ucAlmType[0]=0;   /*almtype£º0¼±¸æ£»4·Ç¼±¸æ£»8×´Ì¬Á¿*/
 977   1        g_ucAlmType[1]=0;
 978   1        g_ucAlmType[2]=0;
 979   1        g_ucAlmType[3]=4;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 17  

 980   1        g_ucAlmType[4]=4;
 981   1        g_ucAlmType[5]=4;
 982   1        g_ucAlmType[6]=8;
 983   1        g_ucAlmType[7]=4;
 984   1        g_ucAlmType[8]=4;
 985   1        g_ucAlmType[9]=0;      /*LP_TIM*/
 986   1        g_ucAlmType[10]=8;         
 987   1        g_ucAlmType[11]=8;  
 988   1        g_ucAlmType[12]=0;
 989   1        g_ucAlmType[13]=0;
 990   1        g_ucAlmType[14]=0;
 991   1        
 992   1      #ifdef NEED_LP_RFI
                g_ucAlmType[15]=4;
              #endif
 995   1      
 996   1        for(j=0;j<(LINENUM-1);j++)
 997   1        {
 998   2          for(i=0;i<(ALMTYPENUM-3);i++)
 999   2          {
1000   3            g_stuAlm[j*(ALMTYPENUM-3)+i].ucLineIndex=j;
1001   3            g_stuAlm[j*(ALMTYPENUM-3)+i].ucAlmIndex=i;
1002   3          }
1003   2        }
1004   1      
1005   1        g_stuAlm[63*(ALMTYPENUM-3)+0].ucLineIndex=63;
1006   1        g_stuAlm[63*(ALMTYPENUM-3)+0].ucAlmIndex=12;
1007   1      
1008   1        g_stuAlm[63*(ALMTYPENUM-3)+1].ucLineIndex=63;
1009   1        g_stuAlm[63*(ALMTYPENUM-3)+1].ucAlmIndex=13;
1010   1      
1011   1        g_stuAlm[63*(ALMTYPENUM-3)+2].ucLineIndex=63;
1012   1        g_stuAlm[63*(ALMTYPENUM-3)+2].ucAlmIndex=14;
1013   1      
1014   1      
1015   1        for(j=0;j<(LINENUM-1);j++)
1016   1        {
1017   2          for(i=0;i<PMTYPENUM;i++)
1018   2          {
1019   3            g_stuPm[j*PMTYPENUM+i].ucLineIndex=j;
1020   3            g_stuPm[j*PMTYPENUM+i].ucPmIndex=i;
1021   3          }
1022   2        }
1023   1      
1024   1        for(i=0;i<UASNUM;i++)
1025   1        {
1026   2          g_liError1s[i].ulDatlong=0;
1027   2          ulSesLmt[i]=700; //ÈôÄ³Ò»ÃëÄÚÎóÂë¸öÊý´óÓÚµÈÓÚulSesLmt[i]Ê±,¸ÃÃëÊÇÑÏÖØÎóÂëÃë//
1028   2        }                  
1029   1      }
1030          
1031          
1032          
1033          /*****************************************************************
1034          ** º¯ÊýÃû:InitioSw1021
1035          ** Êä¡¡Èë: ÎÞ
1036          ** Êä¡¡³ö: ÎÞ
1037          ** ¹¦ÄÜÃèÊö£ºSW1021³õÊ¼»¯
1038          ** È«¾Ö±äÁ¿£º
1039          ** µ÷ÓÃÄ£¿é£º
1040          ** ×÷¡¡Õß£ºcaijun.Li
1041          ** ÈÕ¡¡ÆÚ£º2016.3.18
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 18  

1042          ** ÐÞ¡¡¸Ä£º
1043          ** ÈÕ¡¡ÆÚ£º
1044          ** °æ  ±¾£º1.0
1045          ****************************************************************/
1046          void InitioSw1021()
1047          {
1048   1      
1049   1        unsigned int i,j;
1050   1        unsigned char m,n;
1051   1        first_conf=0;
1052   1      
1053   1        for(i=0; i<CHIPS_ON_BOARD; i++)
1054   1        {
1055   2          XBYTE[SW1021_CHIP_ADDR(i) + SOFTWARE_RST_REG] = SRST_E1 | SRST_SDH_A | SRST_SDH_B;
1056   2          Delay(10);
1057   2          XBYTE[SW1021_CHIP_ADDR(i) + SOFTWARE_RST_REG] = RST_CANCLE;
1058   2          
1059   2          // TODO: ²¢ÐÐ×ÜÏßÊ±ÖÓÑ¡Ôñ
1060   2          // SW1021Ö»Ö§³Ö19.44Mbit/s µÄ´«ÊäËÙÂÊ
1061   2          
1062   2          
1063   2          XBYTE[SW1021_CHIP_ADDR(i) + BUS_CTRL_REG(A_BUS_BASE)] = UPBUS_TIMER | 0x02;  // ÉÏÐÐ×ÜÏß¶¨Ê±  + V5 ÆÚÍûÖ
             -µ 0x02
1064   2          XBYTE[SW1021_CHIP_ADDR(i) + BUS_CTRL_REG(B_BUS_BASE)] = UPBUS_TIMER | 0x02;  // ÉÏÐÐ×ÜÏß¶¨Ê±
1065   2          
1066   2          XBYTE[SW1021_CHIP_ADDR(i) + SOMESET_REG(A_BUS_BASE)] = BLKBIP_BLOCK;  // BIP-2°´¿é½øÐÐÐ£Ñé²¢¼ÆÊý
1067   2          
1068   2          XBYTE[SW1021_CHIP_ADDR(i) + RDI_RFI_CTRL_REG(A_BUS_BASE)] = MREI_AUTO | AISV_RDIEN | LOPV_RDIEN | LOMV_R
             -DIEN | UNEQV_RDIEN | PLMV_RDIEN | RTIMV_RDIEN | RTIUV_RDIEN;
1069   2          
1070   2          // ÉÏÏÂ»°Êý¾Ý×ÜÏß¾ùÑ¡ÔñÅ¼Ð£Ñé
1071   2          XBYTE[SW1021_CHIP_ADDR(i) + SDH_CTRL_REG(A_BUS_BASE)] = UP_DELAY_2;
1072   2          XBYTE[SW1021_CHIP_ADDR(i) + SDH_CTRL_REG(B_BUS_BASE)] = UP_DELAY_2;   
1073   2          
1074   2          // 21¸ö¶Ë¿Ú´ÓA×ÜÏßÉÏÏÂ»°, Ê¹ÓÃ +- HDB3Ä£Ê½
1075   2          for(j=0; j<21; j++){
1076   3            XBYTE[SW1021_CHIP_ADDR(i) + PORT_CFG_REG(j)] = A_UP_DOWN | RnEN;
1077   3            // ¹Ø±ÕÏßÂ·»·»ØºÍÏµÍ³»·»Ø
1078   3            XBYTE[SW1021_CHIP_ADDR(i) + PORT_TEST_REG(j)] = 0x00;
1079   3            // TODO: ÉÏÏÂ»°½»²æ×´Ì¬Ñ¡Ôñ £º ²»½»²æ
1080   3            
1081   3            // TODO: TUÍ¨µÀLOP\AIS¸æ¾¯¼ì²âÉèÖÃ£º EN_TUAIS  Ê¹ÄÜTU-AIS ÖÐ¶Ï
1082   3            //                             EN_TULOP  Ê¹ÄÜTU-LOP ÖÐ¶Ï
1083   3            //                             
1084   3            XBYTE[SW1021_CHIP_ADDR(i) + PORT_E1_ALARM_INTERRPUT_MASK_REG(j)] = E1AISE | E1LOCE; //??
1085   3            XBYTE[SW1021_CHIP_ADDR(i) + INTERRUPT_ENABLE_REG(A_BUS_BASE,j)] = LOPE | AISE;  
1086   3            XBYTE[SW1021_CHIP_ADDR(i) + INTERRUPT_ENABLE_REG(B_BUS_BASE,j)] = LOPE | AISE;  
1087   3            //TODO£º ¶ÁÇåÖÐ¶ÏÖ¸Ê¾
1088   3            
1089   3            //TODO: ²»Æô¶¯Ëæ»úÂë²âÊÔ£» Æô¶¯ÎóÂë¼ÆÊý
1090   3            
1091   3            //TODO: ÉÏ»°V5-TX2 ÉèÖÃ LP-REI
1092   3            XBYTE[SW1021_CHIP_ADDR(i) + TX_V5_REG(A_BUS_BASE,j)] = (0x02 << 1);
1093   3            
1094   3            //TODO£º ÉÏÏÂ»°Í¨µÀºÅ±àÂë
1095   3            XBYTE[SW1021_CHIP_ADDR(i) + RXTU12_SLOT_REG(A_BUS_BASE,j)] = slot[i*21+j];  
1096   3            XBYTE[SW1021_CHIP_ADDR(i) + TXTU12_SLOT_REG(A_BUS_BASE,j)] = slot[i*21+j];  
1097   3            XBYTE[SW1021_CHIP_ADDR(i) + RXTU12_SLOT_REG(B_BUS_BASE,j)] = slot[i*21+j];  
1098   3            XBYTE[SW1021_CHIP_ADDR(i) + TXTU12_SLOT_REG(B_BUS_BASE,j)] = slot[i*21+j];  
1099   3            
1100   3            
1101   3          }
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 19  

1102   2          // TODO:ÉÏÏÂ»°Ê±ÖÓÊý¾ÝÍ¬Ïà
1103   2          XBYTE[SW1021_CHIP_ADDR(i) + E1_CTRL_REG] = TRZSEL | RRZSEL;
1104   2          XBYTE[SW1021_CHIP_ADDR(i) + SDH_IF_CLK_REG] = 0x00;
1105   2      
1106   2        }
1107   1        
1108   1        // Ìî³äËùÓÐÖ§Â·µÄJ2×Ö½Ú£¨³õÊ¼»¯Çå0£©
1109   1        for(i=0;i<63;i++)            
1110   1        {
1111   2          m=i/21;
1112   2          n=i%21;
1113   2          for(j=0;j<16;j++)
1114   2          {
1115   3            if(j==0)
1116   3            { // A 
1117   4              writeTxJ2(m, j, slot[i],  0x80, 0);
1118   4              writeExpectJ2(m, j, slot[i],  0x80, 0);
1119   4              // B
1120   4              writeTxJ2(m, j, slot[i],  0x80, 1);
1121   4              writeExpectJ2(m, j, slot[i],  0x80, 1);           
1122   4            }
1123   3            else
1124   3            {
1125   4              // A 
1126   4              writeTxJ2(m, j, slot[i],  0x00, 0);
1127   4              writeExpectJ2(m, j, slot[i],  0x00, 0);
1128   4              // B
1129   4              writeTxJ2(m, j, slot[i],  0x00, 1);
1130   4              writeExpectJ2(m, j, slot[i],  0x00, 1); 
1131   4            }
1132   3          }
1133   2        }
1134   1      
1135   1         IO8=1;
1136   1         IO9=1;
1137   1         IO10=1;
1138   1         IO11=1;
1139   1         IO12=1;
1140   1         WRHIO;
1141   1      
1142   1      }
1143          /*****************************************************************
1144          ** º¯ÊýÃû:checkSW1021Init
1145          ** Êä¡¡Èë: ÎÞ
1146          ** Êä¡¡³ö: ÎÞ
1147          ** ¹¦ÄÜÃèÊö£º¼ì²éSW1021³õÊ¼»¯³É¹¦
1148          ** È«¾Ö±äÁ¿£º
1149          ** µ÷ÓÃÄ£¿é£º
1150          ** ×÷¡¡Õß£ºcaijun.Li
1151          ** ÈÕ¡¡ÆÚ£º2016.3.18
1152          ** ÐÞ¡¡¸Ä£º
1153          ** ÈÕ¡¡ÆÚ£º
1154          ** °æ  ±¾£º1.0
1155          ****************************************************************/
1156          static int checkSW1021Init(void)
1157          {
1158   1        int ret = 0;
1159   1        int i,j;
1160   1        unsigned int reg;
1161   1        for(i=0;i<CHIPS_ON_BOARD;i++)
1162   1        {
1163   2          reg = XBYTE[SW1021_CHIP_ADDR(i) + BUS_CTRL_REG(A_BUS_BASE)];
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 20  

1164   2          if( (reg & (UPBUS_TIMER | 0x02)) != (UPBUS_TIMER | 0x02)){
1165   3            ret = -1;
1166   3            break;
1167   3          }
1168   2          reg = XBYTE[SW1021_CHIP_ADDR(i) + BUS_CTRL_REG(B_BUS_BASE)];
1169   2          if( (reg & (UPBUS_TIMER | 0x02)) != (UPBUS_TIMER | 0x02)){
1170   3            ret = -1;
1171   3            break;
1172   3          }
1173   2          
1174   2          reg = XBYTE[SW1021_CHIP_ADDR(i) + SDH_CTRL_REG(A_BUS_BASE)];
1175   2          if( (reg & UP_DELAY_2) != UP_DELAY_2){
1176   3            ret = -1;
1177   3            break;
1178   3          }
1179   2          
1180   2          reg = XBYTE[SW1021_CHIP_ADDR(i) + SDH_CTRL_REG(B_BUS_BASE)];
1181   2          if( (reg & UP_DELAY_2) != UP_DELAY_2){
1182   3            ret = -1;
1183   3            break;
1184   3          }
1185   2          
1186   2          for(j=0; j<21; j++){
1187   3            reg = XBYTE[SW1021_CHIP_ADDR(i) + PORT_CFG_REG(j)];
1188   3            if((reg & (A_UP_DOWN | RnEN)) != (A_UP_DOWN | RnEN)){
1189   4              ret = -1;
1190   4              goto quit;
1191   4            }
1192   3          }
1193   2      
1194   2        }
1195   1      quit:
1196   1        return ret;
1197   1      }
1198          
1199          /*****************************************************************
1200          ** º¯ÊýÃû:MAIN
1201          ** Êä¡¡Èë: ÎÞ
1202          ** Êä¡¡³ö: ÎÞ
1203          ** ¹¦ÄÜÃèÊö£ºÖ÷º¯Êý
1204          ** È«¾Ö±äÁ¿£ºg_QuarterFlag
1205          ** µ÷ÓÃÄ£¿é£ºSelfConf(),GetData(),ProcHisData(),Debug();
1206          ** ×÷¡¡Õß£ºcaijun.Li
1207          ** ÈÕ¡¡ÆÚ£º2016.3.18
1208          ** ÐÞ¡¡¸Ä£º
1209          ** ÈÕ¡¡ÆÚ£º
1210          ** °æ  ±¾£º1.0
1211          ****************************************************************/
1212          void main()
1213          {   
1214   1        unsigned char i;  
1215   1        int ret = 0;
1216   1        //Delay(50);
1217   1      
1218   1        SelfConf(); 
1219   1        
1220   1        ret = checkSW1021Init();
1221   1        if(ret != 0)
1222   1          InitioSw1021();
1223   1      
1224   1        while (1)
1225   1        {
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/22/2016 18:21:43 PAGE 21  

1226   2          #ifdef SKIP_DEBUG_CHECK
1227   2            #ifdef NEED_LP_RFI        
                        XBYTE[0x7fe5] = 1;
                    #else
1230   2                XBYTE[0x7b74] = 1;
1231   2            #endif
1232   2          #endif
1233   2          
1234   2          //ACT = ~ACT;
1235   2          //RED = ~RED;
1236   2          //YELLOW = ~YELLOW;
1237   2              
1238   2          
1239   2          ret = checkSW1021Init();
1240   2          if(ret != 0){ 
1241   3            SelfConf(); 
1242   3            InitioSw1021();
1243   3            ConfSet();  
1244   3          }
1245   2        
1246   2          GetData();
1247   2          ProcAlmData();  
1248   2      
1249   2          if (g_QuarterFlag) 
1250   2          {
1251   3            UasQuarter();
1252   3            for(i=0;i<LINENUM;i++)
1253   3            {
1254   4              g_stuPm[i*PMTYPENUM].Value.usint=g_usiBbe[i];
1255   4              g_stuPm[i*PMTYPENUM+1].Value.usint=g_usiEs[i];
1256   4              g_stuPm[i*PMTYPENUM+2].Value.usint=g_usiSes[i];
1257   4            }
1258   3            ProcHisData();  //½«µ±Ç°¸æ¾¯ºÍÐÔÄÜÊý¾Ý´æÎªÀúÊ·Êý¾Ý//
1259   3            g_QuarterFlag=0;
1260   3          }
1261   2          
1262   2          Debug();
1263   2        }
1264   1      }
1265          
*** WARNING C294 IN LINE 833 OF GF2488-01F1-E1-RST.C: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  11497    ----
   CONSTANT SIZE    =    208    ----
   XDATA SIZE       =  22238      88
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
