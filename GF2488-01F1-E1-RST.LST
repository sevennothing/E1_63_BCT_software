C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE GF2488_01F1_E1_RST
OBJECT MODULE PLACED IN GF2488-01F1-E1-RST.OBJ
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE GF2488-01F1-E1-RST.C LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND T
                    -ABS(2)

line level    source

   1          /******************************************************************
   2          ** ÎÄ¼þÃû£ºSTAND.C
   3          ** Copyright (c) 2002 ·é»ðÍ¨ÐÅ´«Êä²úÆ·²¿BCTÈí¼þ×é
   4          ** ´´½¨ÈË£ºÎÌÒæêÍ
   5          ** ÎÄ¼þ±àºÅ£º
   6          ** Ãè¡¡Êö£º±ê×¼Ä£°æ³ÌÐò
   7          **         
   8          ** ÈÕ¡¡ÆÚ£º2002.6.28
   9          ** ÐÞ¸ÄÈË£º
  10          ** ÈÕ¡¡ÆÚ£º
  11          ** ÎÄ¼þ±àºÅ£º
  12          ** Ãè¡¡Êö£º
  13          **
  14          **
  15          ** ±àÒëÆ÷£ºKeil C51 V5.5 »ò MCC68K V4.4
  16          ** ¹«¹²¿â£ºNewLib9.LIB for Mcs51
  17          **         »ò NewLib1.LIB for Mc68302
  18          ** °æ  ±¾£º1.0
  19          ********************************************************************/
  20          //#define  NEED_LP_RFI   /**  !!! µ¥ÅÌÆð²»À´ÁË  */
  21          #define SKIP_DEBUG_CHECK
  22          #define UASNUM    63        //Òª¼ÆËãÎóÂëµÄÏßÂ·Êý63//
  23          #define LINENUM   64        /*¸æ¾¯ÏßÂ·ÊýÎª64*/
  24          #ifdef NEED_LP_RFI
                #define ALMNUM      822     /*×Ü¹²63*(ALMTYPENUM-3)+3=759¸ö¸æ¾¯*/
                #define ALMTYPENUM      16      /*16ÖÖ¸æ¾¯ÀàÐÍ*/
              #else
  28            #define ALMNUM      759     /*×Ü¹²63*(ALMTYPENUM-3)+3=759¸ö¸æ¾¯*/
  29            #define ALMTYPENUM      15      /*15ÖÖ¸æ¾¯ÀàÐÍ*/
  30          #endif
  31          
  32          #define PMNUM   441         /*×Ü¹²63*PMTYPENUM¸öÐÔÄÜ*/
  33          
  34          #define PMTYPENUM       7       /*7ÖÖÐÔÄÜÀàÐÍ*/
  35          #define CONFLEN   2560  /*ÅäÖÃÊý¾Ý³¤¶ÈÎª2560*/
  36          #define STATELEN  338   /*×´Ì¬Êý¾Ý³¤¶ÈÎª338*/
  37          #define BOARDCODE 0x96  /*ÅÌ´úÂë*/
  38          #define WGS21891A 0xB000
  39          
  40          #define SW1021  0xB000    //TODO£ºconfirm
  41          
  42          #define SW1021_CHIP_ADDR(num)  (SW1021 + 0x1000*(num))
  43          //#define SW1021_CHIP_ADDR(num)  (0xD000)
  44          #define CHIPS_ON_BOARD          3
  45          
  46          
  47          #include "commvar9.h"
  48          #include "uasE63.h"
  49          
  50          #include "sw1021.h"
  51          
  52          char code SysName[]="GF2488-01F";
  53          char code BoardName[]="E1-63A";
  54          char code BoardSn[]="WKE2.170.609R1B";
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 2   

  55          char code SoftVer[]="R170609R1B/01F    ";
  56          
  57          char code PcbSn[]="WKE7.822.828R1B";
  58          char code PcbTime[]="2004 05 02";
  59          
  60          char code BoardSoftVer[]="RP0100            ";
  61          
  62          char code SoftDate[]=__DATE__;
  63          char code SoftTime[]=__TIME__;
  64          
  65          extern int sprintf(char *, const char *, ...);
  66          
  67          #define RSTB IO0
  68          #define TUALMO IO2
  69          #define TUXAB IO5 //TUXABÎªÖ÷±¸½»²æÊ±ÖÓÅÌXCUÓÐÐ§Ö¸Ê¾ÐÅºÅ,Ö÷ÓÃXCUÓÐÐ§Ê±TUXAB=0,±¸ÓÃXCUÓÐÐ§TUXAB=1
  70          #define WP IO6     //E1-63AÅÌÔÚÕý³£²ÛÎ»Ê±WP=1,ÔÚ±£»¤²ÛÎ»Ê±WP=0//
  71          #define TUSWTI IO7 //±¾ÅÌalmnumber´óÓÚÒ»¶¨ÖµÊ±,TUALMO=1,XCUÅÌÊÕµ½TUALMO=1Ê±,²úÉúTUSWTI=0//
  72          #define P2V5 IO8
  73          #define P5VI1 IO9
  74          #define P5VI2 IO10
  75          #define DZBI1 IO11
  76          #define DZBI2 IO12
  77          extern unsigned char g_AllClrFlag;
  78          extern unsigned char g_LampEn;
  79          unsigned int ulEsLimit,ulSesLimit;
  80          //unsigned int WGS21891,wgs21891reg0[4],wgs21891reg1[4];
  81          unsigned int sw1021Chip;
  82          unsigned int N1000[63],BIP[63],BIP_2_1S[63],BIP_2_1000S[63];
  83          unsigned char actnumber,almnumber,first_conf;
  84          /*
  85          code unsigned char slot[64]={1,22,43,4,25,46,7,
  86          28,49,10,31,52,13,34,
  87          55,16,37,58,19,40,61,
  88          
  89          2,23,44,5,26,47,8,
  90          29,50,11,32,53,14,35,
  91          56,17,38,59,20,41,62,
  92          
  93          3,24,45,6,27,48,9,
  94          30,51,12,33,54,15,36,
  95          57,18,39,60,21,42,63,0};
  96              */
  97          /*
  98          code unsigned char slot[64]={0x00,0x20,0x40,0x01,0x21,0x41,0x02,
  99                               0x22,0x42,0x03,0x23,0x43,0x04,0x24,
 100                               0x44,0x05,0x25,0x45,0x06,0x26,0x46,
 101          
 102                               0x07,0x27,0x47,0x08,0x28,0x48,0x09,
 103                               0x29,0x49,0x0a,0x2a,0x4a,0x0b,0x2b,
 104                               0x4b,0x0c,0x2c,0x4c,0x0d,0x2d,0x4d,
 105          
 106                               0x0e,0x2e,0x4e,0x0f,0x2f,0x4f,0x10,
 107                               0x30,0x50,0x11,0x31,0x51,0x12,0x32,
 108                               0x52,0x13,0x33,0x53,0x14,0x34,0x54,
 109                               0
 110                          };    
 111          */
 112          code unsigned char slot[64]={0x00,0x07,0x0e,0x01,0x08,0x0f,0x02,
 113                               0x09,0x10,0x03,0x0a,0x11,0x04,0x0b,
 114                               0x12,0x05,0x0c,0x13,0x06,0x0d,0x14,
 115          
 116                               0x20,0x27,0x2e,0x21,0x28,0x2f,0x22,
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 3   

 117                               0x29,0x30,0x23,0x2a,0x31,0x24,0x2b,
 118                               0x32,0x25,0x2c,0x33,0x26,0x2d,0x34,
 119          
 120                               0x40,0x47,0x4e,0x41,0x48,0x4f,0x42,
 121                               0x49,0x50,0x43,0x4a,0x51,0x44,0x4b,
 122                               0x52,0x45,0x4c,0x53,0x46,0x4d,0x54,
 123                               0
 124                          };
 125          
 126              
 127          static void writeTxJ2(char chip, char witchJ2, char Slot, char j2, char busB)
 128          {
 129   1        int copOk = 0;
 130   1        int busBase = A_BUS_BASE;
 131   1        int i = 5;
 132   1        if(busB)
 133   1          busBase = B_BUS_BASE;
 134   1        // write  Tx J2 data
 135   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_TX_DATA_REG(busBase)] = j2;
 136   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_TX_WHICH_REG(busBase)] = witchJ2;
 137   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_TX_SLOT_REG(busBase)] = RW_SEL | Slot;
 138   1        while(!copOk){
 139   2          copOk = XBYTE[SW1021_CHIP_ADDR(chip) + J2_TX_RAM_STATUS_REG(busBase)] & 0x01;
 140   2          i--;
 141   2          if(i == 0)
 142   2            break;
 143   2          //Delay(1);
 144   2        }
 145   1      }
 146          
 147          static void writeExpectJ2(char chip, char witchJ2, char Slot, char j2, char busB)
 148          {
 149   1        int copOk = 0;
 150   1        int busBase = A_BUS_BASE;
 151   1        int i = 5;
 152   1        if(busB) 
 153   1          busBase = B_BUS_BASE;
 154   1        // write  Tx J2 data
 155   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_RX_DATA_REG(busBase)] = j2;
 156   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_RX_J2TYPE_CTRL_REG(busBase)] = EXPECT_J2 |  witchJ2;
 157   1        XBYTE[SW1021_CHIP_ADDR(chip) + J2_RX_CTRL_REG(busBase)] = RW_SEL | Slot;
 158   1        while(!copOk){
 159   2          copOk = XBYTE[SW1021_CHIP_ADDR(chip) + J2_RAM_STATUS_REG(busBase)] & READY;
 160   2          i--;
 161   2          if(i == 0)
 162   2            break;
 163   2          //Delay(1);
 164   2        }
 165   1      }
 166          
 167          /*****************************************************************
 168          ** º¯ÊýÃû:GETDATA
 169          ** Êä¡¡Èë: ÎÞ
 170          ** Êä¡¡³ö: ÎÞ
 171          ** ¹¦ÄÜÃèÊö£º²É¼¯µ¥ÅÌ¸æ¾¯ºÍÐÔÄÜ
 172          ** È«¾Ö±äÁ¿£ºÎÞ
 173          ** µ÷ÓÃÄ£¿é£ºÎÞ
 174          ** ×÷¡¡Õß£ºÎÌÒæêÍ
 175          ** ÈÕ¡¡ÆÚ£º2002.5.25
 176          ** ÐÞ¡¡¸Ä£º
 177          ** ÈÕ¡¡ÆÚ£º
 178          ** °æ  ±¾£º1.0
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 4   

 179          ****************************************************************/
 180          void GetData()          
 181          {
 182   1        unsigned char i,m,n,mi,ni,tmp,tmpi,ADCLK,PPILOS,TULOP,LPSLM,LPTIM,LPTIU,LPRDI,LPRFI,LPUNEQ,TUAIS,PPIAIS,
 183   1        LOOP,LOOPL,tv5;
 184   1        unsigned int  LPFEBE,HDB3;
 185   1        actnumber=0;
 186   1        almnumber=0;
 187   1        sw1021Chip = SW1021;
 188   1        for(i=0;i<(LINENUM-1);i++)
 189   1        {          
 190   2          
 191   2          if(g_ucState[78+i]==0)
 192   2          {
 193   3            g_ucLineMask[i]=1;
 194   3            // ADCLK ¸æ¾¯ (A Â·ÏÂÐÐÊ±ÖÓ¸æ¾¯ )
 195   3            ADCLK=XBYTE[sw1021Chip+E1_IF_STATUS_REG] & ADLOC; 
 196   3      
 197   3          }
 198   2          else   
 199   2          {
 200   3            m=i/21;
 201   3            n=i%21;
 202   3            mi=i/8;
 203   3            ni=i%8;
 204   3            
 205   3            sw1021Chip = SW1021_CHIP_ADDR(m);
 206   3            
 207   3            if(TULOP||TUAIS)
 208   3              g_ucLofFlag[i]=1;      //ÓÐTULOP,TUAIS,PPILOS¸æ¾¯Ö®Ò»Ê±ÉÏ±¨UAS
 209   3            else
 210   3              g_ucLofFlag[i]=0;
 211   3            
 212   3            actnumber=actnumber+g_ucConfData[64+i];
 213   3            
 214   3            ADCLK = XBYTE[sw1021Chip+E1_IF_STATUS_REG] & ADLOC;
 215   3            tmp = XBYTE[sw1021Chip+PORT_E1_ALARM_REG(n)];
 216   3            PPIAIS = tmp & E1AIS;
 217   3            PPILOS = tmp & E1LOS;
 218   3          /*
 219   3            tmp = XBYTE[sw1021Chip+TU12_J2_STATUS_REG2(A_BUS_BASE, n)];
 220   3            TULOP = tmp & LOPI;
 221   3            TUAIS = tmp & AISI;
 222   3            LPSLM = tmp & PLMI;
 223   3            LPTIM = tmp & RTIMI;
 224   3            LPTIU = tmp & RTIUI;
 225   3            LPRDI = tmp & RDII;
 226   3            LPRFI = tmp & RFII;
 227   3            LPUNEQ = tmp & UNEQI;
 228   3          */
 229   3            
 230   3            tmpi = XBYTE[sw1021Chip+TU12_J2_STATUS_REG2(A_BUS_BASE, n)];
 231   3            tmp = XBYTE[sw1021Chip+TU12_J2_STATUS_REG(A_BUS_BASE, n)] | tmpi;
 232   3            TULOP = tmp & LOPV;
 233   3            TUAIS = tmp & AISV;
 234   3            LPSLM = tmp & PLMV;
 235   3            LPTIM = tmp & RTIMV;
 236   3            LPTIU = tmp & RTIUV;
 237   3            LPRDI = tmp & RDIV;
 238   3            LPRFI = tmp & RFIV;
 239   3            LPUNEQ = tmp & UNEQV;
 240   3            
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 5   

 241   3            
 242   3            //must be write BIPERR_COUNTER_REG ; see manual
 243   3            XBYTE[sw1021Chip+BIPERR_COUNTER_REG(A_BUS_BASE, n)] = 0x00;
 244   3            g_liError1s[i].ulDatlong += XBYTE[sw1021Chip+BIPERR_COUNTER_REG(A_BUS_BASE, n)] + (XBYTE[sw1021Chip+BIP
             -ERR_COUNTER_REG(A_BUS_BASE, n) + 1] * 256);   // BIP´íÎó¼ÆÊýÖµ
 245   3            //must be write REI_COUNTER_REG ; see manual
 246   3            XBYTE[sw1021Chip+REI_COUNTER_REG(A_BUS_BASE, n)] = 0x00;
 247   3            LPFEBE = XBYTE[sw1021Chip+REI_COUNTER_REG(A_BUS_BASE, n)] + (XBYTE[sw1021Chip+REI_COUNTER_REG(A_BUS_BAS
             -E, n) + 1] * 256); //REI(FEBE)¼ÆÊýÖµ
 248   3            
 249   3            tmp = XBYTE[sw1021Chip + PORT_TEST_REG(n)];
 250   3                  
 251   3            LOOPL =  tmp & E1LBK;
 252   3            LOOP =   tmp & LnLBK;
 253   3            
 254   3            if((g_ucConfData[200+mi]&(0x01<<ni))==0)
 255   3            {
 256   4              g_stuAlm[i*(ALMTYPENUM-3)+6].ucState=0;
 257   4              if(PPILOS) g_stuAlm[i*(ALMTYPENUM-3)].ucState=1;           
 258   4              else                                              //E1ÊäÈë¿ÚÓÐÐÅºÅÊ±/// 
 259   4              {
 260   5                if(g_stuAlm[i*(ALMTYPENUM-3)].ucState==1)  //Èç¹û»¹´æÔÚPPILOS¸æ¾¯//
 261   5                if(WP==1)                        //·Ç±£»¤ÅÌÎ»Ê±//
 262   5                {
 263   6                  // ÏòµÚiÍ¨µÀÉÏ»°·½Ïò²å¶ÌÊ±¼äµÄÎ±Ëæ»úÂë
 264   6                  XBYTE[sw1021Chip + PORT_TEST_REG(n)] = PRBSEN | PRBST;
 265   6                  g_stuAlm[i*(ALMTYPENUM-3)].ucState=0;//²»¸æPPILOS//
 266   6          
 267   6                  Delay(10);
 268   6                  XBYTE[sw1021Chip + PORT_TEST_REG(n)] = 0x00; //Í£²åÎ±Ëæ»úÂë
 269   6      
 270   6                }
 271   5                else g_stuAlm[i*(ALMTYPENUM-3)].ucState=0;//²»¸æPPILOS////±£»¤ÅÌÎ»Ê±//
 272   5              }
 273   4      
 274   4            }
 275   3            else
 276   3            {
 277   4              g_stuAlm[i*(ALMTYPENUM-3)].ucState=0;
 278   4              if(PPILOS) g_stuAlm[i*(ALMTYPENUM-3)+6].ucState=0;               
 279   4              else  g_stuAlm[i*(ALMTYPENUM-3)+6].ucState=1;
 280   4            }              
 281   3            //if(PPIAIS) g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;               
 282   3            //else g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 283   3            if(TULOP) g_stuAlm[i*(ALMTYPENUM-3)+1].ucState=1;              
 284   3            else g_stuAlm[i*(ALMTYPENUM-3)+1].ucState=0;  
 285   3            if(TUAIS) g_stuAlm[i*(ALMTYPENUM-3)+5].ucState=1;              
 286   3            else g_stuAlm[i*(ALMTYPENUM-3)+5].ucState=0;
 287   3            if(TULOP||TUAIS)
 288   3            {
 289   4              g_stuAlm[i*(ALMTYPENUM-3)+2].ucState=0;
 290   4              g_stuAlm[i*(ALMTYPENUM-3)+3].ucState=0;
 291   4              g_stuAlm[i*(ALMTYPENUM-3)+4].ucState=0;
 292   4              #ifdef NEED_LP_RFI
                      g_stuAlm[i*(ALMTYPENUM-3)+15].ucState=0; 
                      #endif
 295   4              g_stuAlm[i*(ALMTYPENUM-3)+9].ucState=0; 
 296   4            }
 297   3            else
 298   3            {
 299   4              if(LPSLM) g_stuAlm[i*(ALMTYPENUM-3)+2].ucState=1;              
 300   4              else g_stuAlm[i*(ALMTYPENUM-3)+2].ucState=0;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 6   

 301   4              if(LPRDI) g_stuAlm[i*(ALMTYPENUM-3)+3].ucState=1;              
 302   4              else g_stuAlm[i*(ALMTYPENUM-3)+3].ucState=0;
 303   4              if(LPUNEQ) g_stuAlm[i*(ALMTYPENUM-3)+4].ucState=1;               
 304   4              else g_stuAlm[i*(ALMTYPENUM-3)+4].ucState=0;
 305   4      
 306   4              /* ·é»ðÀÏÉè±¸Î´Ê¹ÓÃRFI,²»Ê¹ÓÃÊ±½«ÏÂÃæÁ½¾äÆÁ±Î */
 307   4      #ifdef NEED_LP_RFI
                       if(LPRFI) g_stuAlm[i*(ALMTYPENUM-3)+15].ucState=1;              
                       else g_stuAlm[i*(ALMTYPENUM-3)+15].ucState=0; 
              #endif
 311   4              
 312   4              if(LPTIM) g_stuAlm[i*(ALMTYPENUM-3)+9].ucState=1;              
 313   4              else g_stuAlm[i*(ALMTYPENUM-3)+9].ucState=0;  
 314   4            }
 315   3            if(LOOPL) g_stuAlm[i*(ALMTYPENUM-3)+10].ucState=1;               
 316   3            else g_stuAlm[i*(ALMTYPENUM-3)+10].ucState=0;
 317   3            if(LOOP) g_stuAlm[i*(ALMTYPENUM-3)+11].ucState=1;              
 318   3            else g_stuAlm[i*(ALMTYPENUM-3)+11].ucState=0;
 319   3            if(g_stuPm[i*PMTYPENUM+3].Value.usint>=(0xffff-LPFEBE)) g_stuPm[i*PMTYPENUM+3].Value.usint=0xffff;     
             -  
 320   3            else g_stuPm[i*PMTYPENUM+3].Value.usint+=LPFEBE;   //REI(FEBE)ÐÔÄÜÖµ                    
 321   3            if(g_stuAlm[i*(ALMTYPENUM-3)].ucState==0)                               //ÎÞPPI_LOS¸æ¾¯Ê±
 322   3            {
 323   4               //HDB3±àÂëÎ¥Àý¼ÆÊýÖµ
 324   4              HDB3 = XBYTE[sw1021Chip + HDB3_CV_REG(n)];
 325   4              
 326   4              if(g_stuPm[i*PMTYPENUM+4].Value.usint>=(0xffff-HDB3)) g_stuPm[i*PMTYPENUM+4].Value.usint=0xffff;     
 327   4              else g_stuPm[i*PMTYPENUM+4].Value.usint+=HDB3;      // HDB3ÐÔÄÜÖµ         //g_stuPm[i][4]=HDB3CV
 328   4            }           
 329   3      
 330   3            if(g_stuAlm[i*(ALMTYPENUM-3)+1].ucState||g_stuAlm[i*(ALMTYPENUM-3)+5].ucState)
 331   3            almnumber=almnumber+1;
 332   3            
 333   3            tv5 = XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)];
 334   3            if(g_stuAlm[i*(ALMTYPENUM-3)+1].ucState||g_stuAlm[i*(ALMTYPENUM-3)+5].ucState||g_stuAlm[i*(ALMTYPENUM-3
             -)+4].ucState)
 335   3            { //Èç¹ûTUAIS,TULOP,LPUNEQÖ®Ò»Îª"1" ÔòÏòÉÏ²åVC12=AIS,LPRDI,ÏòÏÂ²åAIS
 336   4                if((tv5 & RDI_CNF) != RDI_CNF)
 337   4                  XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)] = tv5 | RDI_CNF;
 338   4            }
 339   3            else
 340   3            {
 341   4              if((tv5 & RDI_CNF) == RDI_CNF)
 342   4                XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)] = tv5 & (~RDI_CNF);
 343   4            }
 344   3          }
 345   2        }
 346   1        
 347   1        for(i=0;i<(LINENUM-1);i++)
 348   1        {
 349   2          m=i/21;
 350   2          n=i%21;
 351   2          sw1021Chip = SW1021_CHIP_ADDR(m);
 352   2          // »ñÈ¡N2 ºÍ K4 Öµ
 353   2          //TODO: get N2
 354   2          //g_ucState[204+2*i]=XBYTE[WGS21891+0x0100+0x10*n+0x0C]; 
 355   2          g_ucState[205+2*i]=XBYTE[sw1021Chip + RX_K4_REG(A_BUS_BASE,n)];
 356   2          
 357   2          
 358   2          mi=i/8;
 359   2          ni=i%8;
 360   2          if((g_ucConfData[200+mi]&(0x01<<ni))==0)
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 7   

 361   2            g_ucState[330+mi]&=(~(0x01<<ni));
 362   2      
 363   2          else
 364   2            g_ucState[330+mi]|=(0x01<<ni);    
 365   2      
 366   2          //  tv5=XBYTE[WGS21891+0x0100+0x10*n+0x00];
 367   2      
 368   2        }
 369   1      
 370   1         
 371   1      
 372   1        if(TUXAB) g_ucState[77]=0;
 373   1        else g_ucState[77]=1;
 374   1                           
 375   1             
 376   1        if((WP==0) &&(TUSWTI==0))  //±£»¤ÅÌÎ»Ê±,Èç¹ûÃ»ÓÐµ¹»»ACTµÆÂýÉÁ//     
 377   1        {
 378   2          g_ucState[76]=0;
 379   2          g_LampEn=0;        
 380   2          if(g_stuSysClock.ucSecond%2==0) ACT=ON;
 381   2          else ACT=OFF;
 382   2          for(i=0;i<(LINENUM-1);i++)
 383   2          {
 384   3            g_ucLineMask[i]=1;
 385   3            g_ucState[141+i]=1;
 386   3          }
 387   2        }
 388   1        else if(g_ucState[76]==0)
 389   1        {                           
 390   2          for(i=0;i<(LINENUM-1);i++)
 391   2          {
 392   3            if((g_ucConfData[64+i]==0)||(g_ucConfData[137+i]==01))
 393   3            {    
 394   4              g_ucLineMask[i]=1;
 395   4              g_ucState[141+i]=1;  
 396   4            }   
 397   3            else
 398   3            {
 399   4              g_ucLineMask[i]=0;  
 400   4              g_ucState[141+i]=0;
 401   4            }
 402   3          }
 403   2          g_ucState[76]=1;     
 404   2          g_LampEn=1;
 405   2          WROUTPORT;           
 406   2        }
 407   1             
 408   1        UasClear();
 409   1      
 410   1      
 411   1        if(g_AllClrFlag)                //ÇåÐÔÄÜ
 412   1        {   
 413   2          g_bClearUas=1; 
 414   2          g_AllClrFlag=0;
 415   2        }
 416   1      
 417   1        if(g_SecondFlag)                   //Ãë±êÊ¶£¬1£º½øÈëÐÂµÄÒ»Ãë
 418   1        {
 419   2          CalUas(ulSesLmt);           //uas¼ÆËã        
 420   2      
 421   2          for(i=0; i<(LINENUM-1); i++)
 422   2          {
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 8   

 423   3            g_stuPm[i*PMTYPENUM].Value.usint=g_usiBbe[i];         //bbe_lpÐÔÄÜµÄ²É¼¯
 424   3            g_stuPm[i*PMTYPENUM+1].Value.usint=g_usiEs[i];        //es_lpÐÔÄÜµÄ²É¼¯
 425   3            g_stuPm[i*PMTYPENUM+2].Value.usint=g_usiSes[i];       //ses_lpÐÔÄÜµÄ²É¼¯
 426   3            if(g_usiEs[i]>=ulEsLimit) 
 427   3              g_stuAlm[i*(ALMTYPENUM-3)+7].ucState=1;    //curalm[i][8]=es_limit
 428   3            else 
 429   3              g_stuAlm[i*(ALMTYPENUM-3)+7].ucState=0;
 430   3            // if(g_usiSes[i]>=ulSesLimit) g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;    //curalm[i][9]=ses_limit
 431   3            // else g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 432   3            g_stuPm[i*PMTYPENUM+5].Value.usint=g_usiUas[i];             //UAS_LPÐÔÄÜµÄ²É¼¯
 433   3            g_stuPm[i*PMTYPENUM+6].Value.usint=g_usiCses[i];            //cses_lpÐÔÄÜµÄ²É¼¯
 434   3      
 435   3      
 436   3            /******************************************************************************/
 437   3            if(g_stuAlm[i*(ALMTYPENUM-3)+5].ucState||g_stuAlm[i*(ALMTYPENUM-3)+1].ucState)
 438   3            {
 439   4              g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 440   4              BIP[i]=0;
 441   4            }
 442   3            else
 443   3            {
 444   4              BIP_2_1S[i]=BIP[i];
 445   4              BIP_2_1000S[i]+=BIP[i];  
 446   4              BIP[i]=0;
 447   4              switch(g_ucConfData[129])
 448   4              {
 449   5                case 0x04:
 450   5                if(BIP_2_1S[i]>=217) 
 451   5                  g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 452   5                else if(BIP_2_1S[i]<=23) 
 453   5                  g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 454   5                break;
 455   5      
 456   5                case 0x05:
 457   5                if(BIP_2_1S[i]>=22) 
 458   5                  g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 459   5                else if(BIP_2_1S[i]<=3) 
 460   5                  g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 461   5                break;
 462   5      
 463   5                case 0x06:
 464   5      
 465   5      
 466   5                if((N1000[i]>=10)&&(N1000[i]<100))
 467   5                {
 468   6                  if(BIP_2_1000S[i]>=22) 
 469   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 470   6                  else if(BIP_2_1000S[i]<=3) 
 471   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 472   6                  N1000[i]=0;
 473   6                  BIP_2_1000S[i]=0;
 474   6                }
 475   5                else N1000[i]++;
 476   5      
 477   5                break;
 478   5      
 479   5                case 0x07:
 480   5      
 481   5      
 482   5                if((N1000[i]>=100)&&(N1000[i]<1000))
 483   5                {
 484   6                  if(BIP_2_1000S[i]>=22) 
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 9   

 485   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 486   6                  else if(BIP_2_1000S[i]<=3) 
 487   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 488   6                  N1000[i]=0;
 489   6                  BIP_2_1000S[i]=0;
 490   6                }
 491   5                else N1000[i]++;
 492   5                break;
 493   5      
 494   5                case 0x08:
 495   5      
 496   5      
 497   5                if(N1000[i]>=1000)
 498   5                {
 499   6                  if(BIP_2_1000S[i]>=22) 
 500   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=1;
 501   6                  else if(BIP_2_1000S[i]<=3) 
 502   6                    g_stuAlm[i*(ALMTYPENUM-3)+8].ucState=0;
 503   6                  N1000[i]=0;
 504   6                  BIP_2_1000S[i]=0;
 505   6                }
 506   5                else 
 507   5                  N1000[i]++;
 508   5                break;
 509   5              }
 510   4            }
 511   3      
 512   3          /********************************************************************************/
 513   3      
 514   3          }
 515   2      
 516   2          g_SecondFlag=0;      //Ãë±êÊ¶Çå?
 517   2      
 518   2        }     
 519   1      
 520   1        //IO8=1;
 521   1        // WRHIO;
 522   1        //RDHIO;    
 523   1        //IO9=1;
 524   1        // WRHIO;
 525   1        //RDHIO;
 526   1        //IO10=1;
 527   1        // WRHIO;
 528   1        //RDHIO;
 529   1        //IO11=1;
 530   1        // WRHIO;
 531   1        //RDHIO;
 532   1        //IO12=1;
 533   1        // WRHIO;
 534   1        RDHIO;
 535   1      
 536   1         
 537   1             
 538   1        if(ADCLK||(P2V5==0)||(first_conf==0)) 
 539   1          TUALMO=1; //Èç¹û¹¤×÷Ö§Â·ÖÐÈ«²¿ÓÐ¸æ¾¯»ò2.5V//
 540   1        else 
 541   1          TUALMO=0; //µçÔ´ÓÐ¸æ¾¯»òÏÂÅäÖÃÇ°TUALMO=1,·ñÔòTUALMO=0//
 542   1        if((P5VI1==0)&&(DZBI1==0)) 
 543   1          g_stuAlm[63*(ALMTYPENUM-3)+1].ucState=1;
 544   1        else    
 545   1          g_stuAlm[63*(ALMTYPENUM-3)+1].ucState=0;               
 546   1        if((P5VI2==0)&&(DZBI2==0)) 
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 10  

 547   1          g_stuAlm[63*(ALMTYPENUM-3)+2].ucState=1;
 548   1        else    
 549   1          g_stuAlm[63*(ALMTYPENUM-3)+2].ucState=0;       
 550   1        if(P2V5==0) 
 551   1          g_stuAlm[63*(ALMTYPENUM-3)+0].ucState=1;
 552   1        else    
 553   1          g_stuAlm[63*(ALMTYPENUM-3)+0].ucState=0;                     
 554   1       
 555   1      }
 556          
 557          /*****************************************************************
 558          ** º¯ÊýÃû:USERFUN
 559          ** Êä¡¡Èë: ÎÞ
 560          ** Êä¡¡³ö: ÎÞ
 561          ** ¹¦ÄÜÃèÊö£ºÓÃ»§ÊµÊ±´¦Àíº¯Êý£¬10ºÁÃë±»µ÷ÓÃÒ»´Î
 562          ** È«¾Ö±äÁ¿£ºÎÞ
 563          ** µ÷ÓÃÄ£¿é£ºÎÞ
 564          ** ×÷¡¡Õß£ºÎÌÒæêÍ
 565          ** ÈÕ¡¡ÆÚ£º2002.5.25
 566          ** ÐÞ¡¡¸Ä£º
 567          ** ÈÕ¡¡ÆÚ£º
 568          ** °æ  ±¾£º1.0
 569          ****************************************************************/
 570          
 571          void UserFunc() using 1
 572          {
 573   1        return;
 574   1      }
 575          
 576          /*****************************************************************
 577          ** º¯ÊýÃû:CONF_SET
 578          ** Êä¡¡Èë: ÎÞ
 579          ** Êä¡¡³ö: ÎÞ
 580          ** ¹¦ÄÜÃèÊö£ºµ¥ÅÌÅäÖÃ
 581          ** È«¾Ö±äÁ¿£ºÎÞ
 582          ** µ÷ÓÃÄ£¿é£ºÎÞ
 583          ** ×÷¡¡Õß£ºcaijun.Li
 584          ** ÈÕ¡¡ÆÚ£º2016.3.19
 585          ** ÐÞ¡¡¸Ä£º
 586          ** ÈÕ¡¡ÆÚ£º
 587          ** °æ  ±¾£º1.0
 588          ****************************************************************/
 589          void ConfSet(void)
 590          {
 591   1          /*Process ALMMASK*/
 592   1          /*Process PMMASK*/
 593   1        unsigned char i,j,ilong,m,n,temp;
 594   1      
 595   1        g_ucState[69]=g_ucConfData[5];
 596   1        g_ucState[70]=g_ucConfData[6];
 597   1        g_ucState[71]=g_ucConfData[7];
 598   1        g_ucState[72]=g_ucConfData[8];
 599   1        g_ucState[73]=g_ucConfData[9];
 600   1        g_ucState[74]=g_ucConfData[10];
 601   1        g_ucState[75]=g_ucConfData[11];
 602   1        for(i=0;i<(LINENUM-1);i++){
 603   2          m=i/21;
 604   2          n=i%21;
 605   2          sw1021Chip = SW1021_CHIP_ADDR(m);
 606   2        
 607   2          XBYTE[sw1021Chip + RXTU12_SLOT_REG(A_BUS_BASE,n)] = slot[i];  
 608   2          XBYTE[sw1021Chip + TXTU12_SLOT_REG(A_BUS_BASE,n)] = slot[i];  
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 11  

 609   2          XBYTE[sw1021Chip + RXTU12_SLOT_REG(B_BUS_BASE,n)] = slot[i];  
 610   2          XBYTE[sw1021Chip + TXTU12_SLOT_REG(B_BUS_BASE,n)] = slot[i];  
 611   2      
 612   2          if(g_ucConfData[64+i]==0){  // Ö§Â·¹Ø±Õ
 613   3            // ÉÏÏÂ»°Ç¿·¢AIS
 614   3            //XBYTE[sw1021Chip + TX_CTRL_REG(B_BUS_BASE,n)] = AIS_EN; 
 615   3            temp = XBYTE[sw1021Chip + PORT_CFG_REG(n)];
 616   3            XBYTE[sw1021Chip + PORT_CFG_REG(n)] = temp | TAISEN | RAISEN; 
 617   3            XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)] = 0x00;
 618   3                  
 619   3            g_ucState[78+i]=0;     
 620   3            g_ucLineMask[i]=1;
 621   3            g_ucState[141+i]=1;
 622   3          }else{  // Ö§Â·´ò¿ª
 623   3            XBYTE[sw1021Chip + PORT_CFG_REG(n)] = A_UP_DOWN | RnEN;
 624   3            XBYTE[sw1021Chip + TX_V5_REG(A_BUS_BASE,n)] = REI_CNF | (0x02 << 1);  // ×¢ÒâÐÅºÅ±ê¼ÇÖµµÃÅäÖÃ
 625   3            if(g_ucState[78+i]==0)//¸Õ´ò¿ªÖ§Â·¿ª¹ØÊ±²åÎ±Ëæ»úÂë
 626   3            {
 627   4              //TODO: Æô¶¯ÎóÂë¼ÆÊýÆ÷
 628   4              XBYTE[sw1021Chip + PORT_TEST_REG(n)] = PRBSEN | PRBST;
 629   4              Delay(5);
 630   4              XBYTE[sw1021Chip + PORT_TEST_REG(n)] = 0x00;
 631   4              g_ucState[78+i]=1;
 632   4              g_ucLineMask[i]=0; 
 633   4              g_ucState[141+i]=0;
 634   4            }         
 635   3          }
 636   2          XBYTE[sw1021Chip + TX_K4_REG(A_BUS_BASE,n)]= g_ucConfData[263+4*i+2];               // K4 ·¢ 
 637   2          XBYTE[sw1021Chip + TX_K4_REG(B_BUS_BASE,n)]= g_ucConfData[263+4*i+2];               // K4 ·¢ 
 638   2          // TODO: N2 ·¢
 639   2          //XBYTE[WGS21891+0x0100+0x10*n+0x01]=g_ucConfData[263+4*i];                 // N2 ·¢
 640   2        
 641   2          // J2 ·¢ ºÍ ÆÚÍûÊÕ
 642   2          for(j=0;j<16;j++)
 643   2          {
 644   3            if(j==0) temp=0x80;
 645   3            else temp=0;
 646   3            
 647   3            // A 
 648   3            writeTxJ2(m, j, slot[i],  temp|g_ucConfData[515+2*i*16+j], 0);
 649   3            writeExpectJ2(m, j, slot[i],  temp|g_ucConfData[515+16+2*i*16+j], 0);
 650   3            // B
 651   3            writeTxJ2(m, j, slot[i],  temp|g_ucConfData[515+2*i*16+j], 1);
 652   3            writeExpectJ2(m, j, slot[i],  temp|g_ucConfData[515+16+2*i*16+j], 1);
 653   3          }
 654   2          
 655   2          if(g_ucConfData[137+i]==0)   //confdata[137+i]==0²»ÆÁ±ÎÖ§Â·i¸æ¾¯/·ñÔòÆÁ±ÎÖ§Â·i¸æ¾¯//
 656   2          {
 657   3            g_ucLineMask[i]=0;
 658   3            g_ucState[141+i]=0;
 659   3          }
 660   2          else
 661   2          {
 662   3            g_ucLineMask[i]=1;
 663   3            g_ucState[141+i]=1;
 664   3          }
 665   2        //if(g_ucConfData[200+i]==0)     //confdata[200+i]==1Ö§Â·i×°ÔØ/·ñÔò²»×°ÔØ//
 666   2        //XBYTE[WGS21891+0x0100+0x10*n+0x00]=0x00;
 667   2        // else  XBYTE[WGS21891+0x0100+0x10*n+0x00]=0x04;
 668   2      
 669   2        }
 670   1      
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 12  

 671   1      
 672   1      
 673   1        for(j=0;j<ALMTYPENUM;j++) 
 674   1        {
 675   2           
 676   2           for(ilong=29;ilong<(29+ALMTYPENUM);ilong++)
 677   2           {    
 678   3              if(g_ucConfData[ilong]==g_ucAlmCode[j])   //´ÓÍø¹ÜÉè¸æ¾¯ÆÁ±Î//
 679   3              {
 680   4               g_ucAlmMask[j]=1;                              
 681   4               break;     
 682   4              }
 683   3              else
 684   3              g_ucAlmMask[j]=0;
 685   3      
 686   3           }
 687   2        }      
 688   1                          
 689   1        for(j=0;j<PMTYPENUM;j++)  
 690   1        {
 691   2      
 692   2          for(ilong=54;ilong<(54+PMTYPENUM);ilong++)
 693   2          {   
 694   3            if(g_ucConfData[ilong]==g_ucPmCode[j])   //´ÓÍø¹ÜÉèÐÔÄÜÆÁ±Î//
 695   3            {
 696   4              g_ucPmMask[j]=1;                              
 697   4              break;    
 698   4            }
 699   3            else
 700   3              g_ucPmMask[j]=0;
 701   3          }
 702   2        }        
 703   1      
 704   1        ulEsLimit=256*g_ucConfData[131]+g_ucConfData[132];    //´ÓÍø¹ÜÉèulEsLimitÃÅÏÞ//
 705   1        ulSesLimit=256*g_ucConfData[134]+g_ucConfData[135];   //´ÓÍø¹ÜÉèulSesLimitÃÅÏÞ//
 706   1      
 707   1        //if((g_ucConfData[136]==0)&&TUALMO&&WP) TUALMO=0;  //IO2=TUALMO  confdata[108]=ÅÌ±£»¤Ä£Ê½²»±£»¤
 708   1      
 709   1      
 710   1        // g_ucConfChange=0;                          
 711   1              
 712   1      
 713   1        if(first_conf==0) first_conf=1; 
 714   1      }
 715          
 716          
 717          /*****************************************************************
 718          ** º¯ÊýÃû:UserHdlc
 719          ** Êä¡¡Èë: ÎÞ
 720          ** Êä¡¡³ö: ÎÞ
 721          ** ¹¦ÄÜÃèÊö£ºµ¥ÅÌÌØÊâÃüÁî´¦Àí
 722          ** È«¾Ö±äÁ¿£ºÎÞ
 723          ** µ÷ÓÃÄ£¿é£ºÎÞ
 724          ** ×÷¡¡Õß£ºcaijun.Li
 725          ** ÈÕ¡¡ÆÚ£º2016.3.19
 726          ** ÐÞ¡¡¸Ä£º
 727          ** ÈÕ¡¡ÆÚ£º
 728          ** °æ  ±¾£º1.0
 729          ****************************************************************/
 730          void UserHdlc(void)
 731          {
 732   1        unsigned char i,m,n,temp;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 13  

 733   1        unsigned int addr;
 734   1      
 735   1        if (g_ucHdlcBuf[CMD_TYPE]==COMM_CATA)
 736   1        {
 737   2          if (g_ucHdlcBuf[CMD_CODE]==RTRV_OCONF)
 738   2          {
 739   3            g_ucHdlcBuf[CHARACTER1]=CMD_RIGHT;
 740   3          }
 741   2          else if (g_ucHdlcBuf[CMD_CODE]==SET_OCONF)
 742   2          {
 743   3            g_ucHdlcBuf[CHARACTER1]=CMD_RIGHT;                                               
 744   3          }
 745   2        }
 746   1      
 747   1      
 748   1        switch(g_ucHdlcBuf[5])
 749   1        {
 750   2          case 0x00:    /*SET_LOOP*/
 751   2            if(g_ucHdlcBuf[6]==0x34)
 752   2            { // Éè±¸»·»Ø
 753   3              if(((g_usRxDataLen)==0)||((g_usRxDataLen)>63)) 
 754   3                g_ucHdlcBuf[10]=0x80; 
 755   3              else                
 756   3                for(i=0;i<(g_usRxDataLen);i++)
 757   3                {
 758   4                  temp=g_ucHdlcBuf[14+i]-1;
 759   4                  m=temp/21;
 760   4                  n=temp%21;
 761   4      
 762   4                  sw1021Chip = SW1021_CHIP_ADDR(m);
 763   4                  if(g_ucHdlcBuf[7]==0x01){
 764   5                    XBYTE[sw1021Chip + PORT_TEST_REG(n)] |= LnLBK;
 765   5                  }else{
 766   5                    XBYTE[sw1021Chip + PORT_TEST_REG(n)] &= (~LnLBK);
 767   5                  }
 768   4                  g_ucHdlcBuf[10]=0x00;
 769   4                }
 770   3            }
 771   2            else if(g_ucHdlcBuf[6]==0x33)       /*SET_LOOPL*/
 772   2            { // ÏßÂ·»·»Ø 
 773   3              if(((g_usRxDataLen)==0)||((g_usRxDataLen)>63)) 
 774   3                g_ucHdlcBuf[10]=0x80; 
 775   3              else                  
 776   3                for(i=0;i<(g_usRxDataLen);i++)
 777   3                {
 778   4                  temp=g_ucHdlcBuf[14+i]-1;
 779   4                  m=temp/21;
 780   4                  n=temp%21;
 781   4                  
 782   4                  sw1021Chip = SW1021_CHIP_ADDR(m);
 783   4                  if(g_ucHdlcBuf[7]==0x01){
 784   5                    XBYTE[sw1021Chip + PORT_TEST_REG(n)] |= E1LBK;
 785   5                  }else{
 786   5                    XBYTE[sw1021Chip + PORT_TEST_REG(n)] &= (~E1LBK);
 787   5                  }
 788   4                  g_ucHdlcBuf[10]=0x00;
 789   4                }
 790   3            }
 791   2      
 792   2            break;
 793   2      
 794   2          case 0x77:                /**Í¸Ã÷Ö¡ÃüÁî**/
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 14  

 795   2            addr=256*g_ucHdlcBuf[14]+g_ucHdlcBuf[15];  // commbuf[14]£¬commbuf[15]Ëù´æ·Å µÄ µØÖ·
 796   2            g_ucHdlcBuf[10]=0x00;
 797   2            g_ucHdlcBuf[11]=0x00;
 798   2            g_ucHdlcBuf[12]=0x00;
 799   2            g_ucHdlcBuf[13]=0x11;
 800   2            //¶Á16¸ö×Ö½Ú//  addr µØÖ·¿ªÊ¼¶ÁÈ¡16¸ö×Ö½ÚÊý¾Ý//
 801   2            for(i=0;i<16;i++) 
 802   2              g_ucHdlcBuf[14+i]=XBYTE[addr+i]; 
 803   2            g_ucHdlcBuf[30]=P1;
 804   2            break;                   
 805   2          
 806   2          case 0x88:
 807   2            addr=256*g_ucHdlcBuf[14]+g_ucHdlcBuf[15];
 808   2            XBYTE[addr]=g_ucHdlcBuf[16];       //½«commbuf[16]´æ·ÅµÄÊý¾ÝËÍÈëcommbuf[14]£¬//
 809   2            g_ucHdlcBuf[10]=0x00;              //commbuf[15]Ëù´æ·ÅµÄWGS21891µÄµØÖ·µ¥ÔªÖÐ//
 810   2            g_ucHdlcBuf[11]=0x00;
 811   2            g_ucHdlcBuf[12]=0x00;
 812   2            g_ucHdlcBuf[13]=0x10;              //¶Á16¸ö×Ö½Ú//
 813   2            for(i=0;i<16;i++) 
 814   2              g_ucHdlcBuf[14+i]=XBYTE[addr+i]; //´Ócommbuf[14]£¬commbuf[15]µÄµØÖ·¿ªÊ¼¶ÁÈ¡16¸ö×Ö½ÚÊý¾Ý//
 815   2            break;
 816   2      
 817   2          case 0X99:
 818   2            while(1)
 819   2            {;}
 820   2            if((g_usRxDataLen==0)||(g_usRxDataLen>63)) 
 821   2              g_ucHdlcBuf[10]=0x80; 
 822   2            else                
 823   2              for(i=0;i<(g_usRxDataLen);i++)
 824   2              {
 825   3                temp=g_ucHdlcBuf[14+i]-1;
 826   3                m=temp/21;
 827   3                n=temp%21;
 828   3                sw1021Chip = SW1021_CHIP_ADDR(m);
 829   3                          
 830   3                g_ucHdlcBuf[17]=XBYTE[sw1021Chip + PORT_TEST_REG(n)];
 831   3                g_ucHdlcBuf[18]=0xbb;
 832   3                
 833   3                if(g_ucHdlcBuf[7]==0x01)
 834   3                {
 835   4                  XBYTE[sw1021Chip + PORT_TEST_REG(n)] |= LnLBK;
 836   4                  if(n<8)
 837   4                    g_ucHdlcBuf[18]=0xff;
 838   4                }
 839   3                else
 840   3                {
 841   4                  XBYTE[sw1021Chip + PORT_TEST_REG(n)] &= (~LnLBK);
 842   4                }
 843   3                    
 844   3              }
 845   2            g_ucHdlcBuf[10]=0x00;
 846   2            g_ucHdlcBuf[13]=6;
 847   2            g_ucHdlcBuf[14]=0xaa;
 848   2            g_ucHdlcBuf[15]=m;
 849   2            g_ucHdlcBuf[16]=n;
 850   2            g_ucHdlcBuf[19]=XBYTE[sw1021Chip + PORT_TEST_REG(n)];
 851   2            
 852   2            break;
 853   2            
 854   2      
 855   2        }
 856   1      
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 15  

 857   1      }
 858          
 859          /*****************************************************************
 860          ** º¯ÊýÃû:SELF_CONF
 861          ** Êä¡¡Èë: ÎÞ
 862          ** Êä¡¡³ö: ÎÞ
 863          ** ¹¦ÄÜÃèÊö£ºµ¥ÅÌÉÏµçÄ¬ÈÏÅäÖÃ
 864          ** È«¾Ö±äÁ¿£ºg_ucConfData[]
 865          ** µ÷ÓÃÄ£¿é£ºÎÞ
 866          ** ×÷¡¡Õß£ºÎÌÒæêÍ
 867          ** ÈÕ¡¡ÆÚ£º2002.5.25
 868          ** ÐÞ¡¡¸Ä£º
 869          ** ÈÕ¡¡ÆÚ£º
 870          ** °æ  ±¾£º1.0
 871          ** ×¢  Òâ£ºËùÓÐ¸æ¾¯ºÍÐÔÄÜµÄ³õÊ¼»¯Ðè°²ÏßÂ·ºÅË³Ðò
 872          ****************************************************************/
 873          void SelfConf()
 874          {
 875   1      
 876   1        unsigned int i,j;
 877   1        char ctt[18];
 878   1        unsigned char ucii;
 879   1        //  first_conf=0;
 880   1        g_ucConfData[22]=BOARDCODE;/*BDINF5*/
 881   1        g_ucConfData[0]=0xfe;
 882   1      
 883   1      
 884   1        sprintf(ctt,BoardSn);
 885   1        for(ucii=0;ucii<15;ucii++) g_ucState[ucii]=ctt[ucii];  /*ÅÌºÅ*/
 886   1      
 887   1        sprintf(ctt,PcbSn);   
 888   1        for(ucii=0;ucii<15;ucii++) g_ucState[15+ucii]=ctt[ucii]; /*°åºÅ*/
 889   1      
 890   1        sprintf(ctt,PcbTime);   
 891   1        for(ucii=0;ucii<10;ucii++) g_ucState[30+ucii]=ctt[ucii]; /*ÖÆ°åÊ±¼ä*/
 892   1      
 893   1        for(ucii=0;ucii<18;ucii++) ctt[ucii]=0;    /*°æ±¾ºÅbufÇåÁã*/
 894   1        //sprintf(ctt,"R170609R1B/01F    "); 
 895   1        //for(ucii=0;ucii<18;ucii++) g_ucState[40+ucii]=ctt[ucii];
 896   1        sprintf(ctt,BoardSoftVer); 
 897   1        for(ucii=0;ucii<18;ucii++) g_ucState[40+ucii]=ctt[ucii];
 898   1        sprintf(ctt,__DATE__);   
 899   1        for(ucii=0;ucii<11;ucii++) g_ucState[58+ucii]=ctt[ucii]; /*±à³ÌÊ±¼ä*/
 900   1      
 901   1        //g_ucState[69]=0x07;
 902   1        //g_ucState[70]=0xD1;
 903   1        //g_ucState[71]=0x06;
 904   1        //g_ucState[72]=0x01;
 905   1        //g_ucState[73]=0x08;
 906   1        //g_ucState[74]=0x00;
 907   1        //g_ucState[75]=0x00;
 908   1        g_ucState[76]=0x01;
 909   1        //g_ucState[77]=0x01;
 910   1      
 911   1      
 912   1      
 913   1      
 914   1      
 915   1      
 916   1        for(i=0;i<LINENUM;i++)           /*linecode=1..63*/
 917   1          g_ucLineCode[i]=i+1;
 918   1        for(i=0;i<LINENUM;i++)
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 16  

 919   1        {
 920   2          g_ucLineMask[i]=0;          
 921   2      
 922   2        }
 923   1      
 924   1      
 925   1      
 926   1        /*for(i=0;i<LINENUM;i++)
 927   1        for(j=0;j<PMNUM;j++) linepmmask[i][j]=0;*/         
 928   1      
 929   1      
 930   1        actnumber=63;             
 931   1        almnumber=0;     
 932   1      
 933   1        ulEsLimit=0xff;
 934   1        ulSesLimit=0xff;
 935   1      
 936   1        g_ucAlmCode[0]=0x03;                        /*PPI_LOS*/
 937   1        g_ucAlmCode[1]=0x27;                        /*TU_LOP*/
 938   1        g_ucAlmCode[2]=0x22;                        /*LP_SLM*/
 939   1        g_ucAlmCode[3]=0x20;                        /*LP_RDI*/
 940   1        g_ucAlmCode[4]=0x24;                        /*LP_UNEQ*/
 941   1        //g_ucAlmCode[8]=0x04;                        /*PPI_AIS*/
 942   1        g_ucAlmCode[5]=0x02;                        /*TU_AIS*/
 943   1      #ifdef NEED_LP_RFI
                g_ucAlmCode[15]=0x0c;                        /*LP_RFI*/
              #endif
 946   1        g_ucAlmCode[7]=0x51;                        /*ES_LIMIT*/
 947   1        //g_ucAlmCode[8]=0x52;      /*SES _LIMIT*/
 948   1        g_ucAlmCode[9]=0x28;                       /*LP_TIM*/
 949   1        g_ucAlmCode[10]=0x4f;                       /*LOOPL*/
 950   1        g_ucAlmCode[11]=0x55;     /*LOOP*/
 951   1        g_ucAlmCode[12]=0x01;                       //2V5µçÔ´¹ÊÕÏ¸æ¾¯//
 952   1        g_ucAlmCode[13]=0x05;                       //5VI1µçÔ´¹ÊÕÏ¸æ¾¯//
 953   1        g_ucAlmCode[14]=0x06;                       //5VI2µçÔ´¹ÊÕÏ¸æ¾¯//
 954   1        g_ucAlmCode[6]=0x07;                 //trafic-onload//
 955   1        g_ucAlmCode[8]=0x08;                /*LP_SD*/
 956   1      
 957   1        g_ucPmCode[0]=0x08;                   /*BBE_LP*/
 958   1        g_ucPmCode[1]=0x02;                   /*ES_LP*/
 959   1        g_ucPmCode[2]=0x03;                   /*SES_LP*/
 960   1        g_ucPmCode[3]=0x07;                   /*REI_LP*/
 961   1        g_ucPmCode[4]=0x0b;                   /*HDB3CV*/
 962   1        //g_ucPmCode[5]=0x06;                 /*UAS_LP*/
 963   1        g_ucPmCode[5]=0x0c;                   /*UAS_LP*/
 964   1        g_ucPmCode[6]=0xa2;                   /*CSES_LP*/
 965   1      
 966   1        g_ucAlmType[0]=0;   /*almtype£º0¼±¸æ£»4·Ç¼±¸æ£»8×´Ì¬Á¿*/
 967   1        g_ucAlmType[1]=0;
 968   1        g_ucAlmType[2]=0;
 969   1        g_ucAlmType[3]=4;
 970   1        g_ucAlmType[4]=4;
 971   1        g_ucAlmType[5]=4;
 972   1        g_ucAlmType[6]=8;
 973   1        g_ucAlmType[7]=4;
 974   1        g_ucAlmType[8]=4;
 975   1        g_ucAlmType[9]=0;      /*LP_TIM*/
 976   1        g_ucAlmType[10]=8;         
 977   1        g_ucAlmType[11]=8;  
 978   1        g_ucAlmType[12]=0;
 979   1        g_ucAlmType[13]=0;
 980   1        g_ucAlmType[14]=0;
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 17  

 981   1        
 982   1      #ifdef NEED_LP_RFI
                g_ucAlmType[15]=4;
              #endif
 985   1      
 986   1        for(j=0;j<(LINENUM-1);j++)
 987   1        {
 988   2          for(i=0;i<(ALMTYPENUM-3);i++)
 989   2          {
 990   3            g_stuAlm[j*(ALMTYPENUM-3)+i].ucLineIndex=j;
 991   3            g_stuAlm[j*(ALMTYPENUM-3)+i].ucAlmIndex=i;
 992   3          }
 993   2        }
 994   1      
 995   1        g_stuAlm[63*(ALMTYPENUM-3)+0].ucLineIndex=63;
 996   1        g_stuAlm[63*(ALMTYPENUM-3)+0].ucAlmIndex=12;
 997   1      
 998   1        g_stuAlm[63*(ALMTYPENUM-3)+1].ucLineIndex=63;
 999   1        g_stuAlm[63*(ALMTYPENUM-3)+1].ucAlmIndex=13;
1000   1      
1001   1        g_stuAlm[63*(ALMTYPENUM-3)+2].ucLineIndex=63;
1002   1        g_stuAlm[63*(ALMTYPENUM-3)+2].ucAlmIndex=14;
1003   1      
1004   1      
1005   1        for(j=0;j<(LINENUM-1);j++)
1006   1        {
1007   2          for(i=0;i<PMTYPENUM;i++)
1008   2          {
1009   3            g_stuPm[j*PMTYPENUM+i].ucLineIndex=j;
1010   3            g_stuPm[j*PMTYPENUM+i].ucPmIndex=i;
1011   3          }
1012   2        }
1013   1      
1014   1        for(i=0;i<UASNUM;i++)
1015   1        {
1016   2          g_liError1s[i].ulDatlong=0;
1017   2          ulSesLmt[i]=700; //ÈôÄ³Ò»ÃëÄÚÎóÂë¸öÊý´óÓÚµÈÓÚulSesLmt[i]Ê±,¸ÃÃëÊÇÑÏÖØÎóÂëÃë//
1018   2        }                  
1019   1      }
1020          
1021          
1022          
1023          /*****************************************************************
1024          ** º¯ÊýÃû:InitioSw1021
1025          ** Êä¡¡Èë: ÎÞ
1026          ** Êä¡¡³ö: ÎÞ
1027          ** ¹¦ÄÜÃèÊö£ºSW1021³õÊ¼»¯
1028          ** È«¾Ö±äÁ¿£º
1029          ** µ÷ÓÃÄ£¿é£º
1030          ** ×÷¡¡Õß£ºcaijun.Li
1031          ** ÈÕ¡¡ÆÚ£º2016.3.18
1032          ** ÐÞ¡¡¸Ä£º
1033          ** ÈÕ¡¡ÆÚ£º
1034          ** °æ  ±¾£º1.0
1035          ****************************************************************/
1036          void InitioSw1021()
1037          {
1038   1      
1039   1        unsigned int i,j;
1040   1        unsigned char m,n;
1041   1        first_conf=0;
1042   1      
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 18  

1043   1        for(i=0; i<CHIPS_ON_BOARD; i++)
1044   1        {
1045   2          XBYTE[SW1021_CHIP_ADDR(i) + SOFTWARE_RST_REG] = SRST_E1 | SRST_SDH_A | SRST_SDH_B;
1046   2          Delay(10);
1047   2          XBYTE[SW1021_CHIP_ADDR(i) + SOFTWARE_RST_REG] = RST_CANCLE;
1048   2          
1049   2          // TODO: ²¢ÐÐ×ÜÏßÊ±ÖÓÑ¡Ôñ
1050   2          // SW1021Ö»Ö§³Ö19.44Mbit/s µÄ´«ÊäËÙÂÊ
1051   2          
1052   2          
1053   2          XBYTE[SW1021_CHIP_ADDR(i) + BUS_CTRL_REG(A_BUS_BASE)] = UPBUS_TIMER | 0x02;  // ÉÏÐÐ×ÜÏß¶¨Ê±  + V5 ÆÚÍûÖ
             -µ 0x02
1054   2          XBYTE[SW1021_CHIP_ADDR(i) + BUS_CTRL_REG(B_BUS_BASE)] = UPBUS_TIMER | 0x02;  // ÉÏÐÐ×ÜÏß¶¨Ê±
1055   2          
1056   2          // ÉÏÏÂ»°Êý¾Ý×ÜÏß¾ùÑ¡ÔñÅ¼Ð£Ñé
1057   2          XBYTE[SW1021_CHIP_ADDR(i) + SDH_CTRL_REG(A_BUS_BASE)] = UP_DELAY_2;
1058   2          XBYTE[SW1021_CHIP_ADDR(i) + SDH_CTRL_REG(B_BUS_BASE)] = UP_DELAY_2;
1059   2          
1060   2          // 21¸ö¶Ë¿Ú´ÓA×ÜÏßÉÏÏÂ»°, Ê¹ÓÃ +- HDB3Ä£Ê½
1061   2          for(j=0; j<21; j++){
1062   3            XBYTE[SW1021_CHIP_ADDR(i) + PORT_CFG_REG(j)] = A_UP_DOWN | RnEN;
1063   3            // ¹Ø±ÕÏßÂ·»·»ØºÍÏµÍ³»·»Ø
1064   3            XBYTE[SW1021_CHIP_ADDR(i) + PORT_TEST_REG(j)] = 0x00;
1065   3            // TODO: ÉÏÏÂ»°½»²æ×´Ì¬Ñ¡Ôñ £º ²»½»²æ
1066   3            
1067   3            // TODO: TUÍ¨µÀLOP\AIS¸æ¾¯¼ì²âÉèÖÃ£º EN_TUAIS  Ê¹ÄÜTU-AIS ÖÐ¶Ï
1068   3            //                             EN_TULOP  Ê¹ÄÜTU-LOP ÖÐ¶Ï
1069   3            //                             
1070   3            XBYTE[SW1021_CHIP_ADDR(i) + PORT_E1_ALARM_INTERRPUT_MASK_REG(j)] = E1AISE | E1LOCE; //??
1071   3            XBYTE[SW1021_CHIP_ADDR(i) + INTERRUPT_ENABLE_REG(A_BUS_BASE,j)] = LOPE | AISE;  
1072   3            XBYTE[SW1021_CHIP_ADDR(i) + INTERRUPT_ENABLE_REG(B_BUS_BASE,j)] = LOPE | AISE;  
1073   3            //TODO£º ¶ÁÇåÖÐ¶ÏÖ¸Ê¾
1074   3            
1075   3            //TODO: ²»Æô¶¯Ëæ»úÂë²âÊÔ£» Æô¶¯ÎóÂë¼ÆÊý
1076   3            
1077   3            //TODO: ÉÏ»°V5-TX2 ÉèÖÃ LP-REI
1078   3            XBYTE[SW1021_CHIP_ADDR(i) + TX_V5_REG(A_BUS_BASE,j)] = REI_CNF | (0x02 << 1);
1079   3            
1080   3            //TODO£º ÉÏÏÂ»°Í¨µÀºÅ±àÂë
1081   3            XBYTE[SW1021_CHIP_ADDR(i) + RXTU12_SLOT_REG(A_BUS_BASE,j)] = slot[i*21+j];  
1082   3            XBYTE[SW1021_CHIP_ADDR(i) + TXTU12_SLOT_REG(A_BUS_BASE,j)] = slot[i*21+j];  
1083   3            XBYTE[SW1021_CHIP_ADDR(i) + RXTU12_SLOT_REG(B_BUS_BASE,j)] = slot[i*21+j];  
1084   3            XBYTE[SW1021_CHIP_ADDR(i) + TXTU12_SLOT_REG(B_BUS_BASE,j)] = slot[i*21+j];  
1085   3            
1086   3            
1087   3          }
1088   2          // TODO:ÉÏÏÂ»°Ê±ÖÓÊý¾ÝÍ¬Ïà
1089   2          XBYTE[SW1021_CHIP_ADDR(i) + E1_CTRL_REG] = TRZSEL | RRZSEL;
1090   2          XBYTE[SW1021_CHIP_ADDR(i) + SDH_IF_CLK_REG] = 0x00;
1091   2      
1092   2        }
1093   1        
1094   1        // Ìî³äËùÓÐÖ§Â·µÄJ2×Ö½Ú£¨³õÊ¼»¯Çå0£©
1095   1        for(i=0;i<63;i++)            
1096   1        {
1097   2          m=i/21;
1098   2          n=i%21;
1099   2          for(j=0;j<16;j++)
1100   2          {
1101   3            if(j==0)
1102   3            { // A 
1103   4              writeTxJ2(m, j, slot[i],  0x80, 0);
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 19  

1104   4              writeExpectJ2(m, j, slot[i],  0x80, 0);
1105   4              // B
1106   4              writeTxJ2(m, j, slot[i],  0x80, 1);
1107   4              writeExpectJ2(m, j, slot[i],  0x80, 1);           
1108   4            }
1109   3            else
1110   3            {
1111   4              // A 
1112   4              writeTxJ2(m, j, slot[i],  0x00, 0);
1113   4              writeExpectJ2(m, j, slot[i],  0x00, 0);
1114   4              // B
1115   4              writeTxJ2(m, j, slot[i],  0x00, 1);
1116   4              writeExpectJ2(m, j, slot[i],  0x00, 1); 
1117   4            }
1118   3          }
1119   2        }
1120   1      
1121   1         IO8=1;
1122   1         IO9=1;
1123   1         IO10=1;
1124   1         IO11=1;
1125   1         IO12=1;
1126   1         WRHIO;
1127   1      
1128   1      }
1129          /*****************************************************************
1130          ** º¯ÊýÃû:checkSW1021Init
1131          ** Êä¡¡Èë: ÎÞ
1132          ** Êä¡¡³ö: ÎÞ
1133          ** ¹¦ÄÜÃèÊö£º¼ì²éSW1021³õÊ¼»¯³É¹¦
1134          ** È«¾Ö±äÁ¿£º
1135          ** µ÷ÓÃÄ£¿é£º
1136          ** ×÷¡¡Õß£ºcaijun.Li
1137          ** ÈÕ¡¡ÆÚ£º2016.3.18
1138          ** ÐÞ¡¡¸Ä£º
1139          ** ÈÕ¡¡ÆÚ£º
1140          ** °æ  ±¾£º1.0
1141          ****************************************************************/
1142          static int checkSW1021Init(void)
1143          {
1144   1        int ret = 0;
1145   1        int i,j;
1146   1        unsigned int reg;
1147   1        for(i=0;i<CHIPS_ON_BOARD;i++)
1148   1        {
1149   2          reg = XBYTE[SW1021_CHIP_ADDR(i) + BUS_CTRL_REG(A_BUS_BASE)];
1150   2          if( (reg & (UPBUS_TIMER | 0x02)) != (UPBUS_TIMER | 0x02)){
1151   3            ret = -1;
1152   3            break;
1153   3          }
1154   2          reg = XBYTE[SW1021_CHIP_ADDR(i) + BUS_CTRL_REG(B_BUS_BASE)];
1155   2          if( (reg & (UPBUS_TIMER | 0x02)) != (UPBUS_TIMER | 0x02)){
1156   3            ret = -1;
1157   3            break;
1158   3          }
1159   2          
1160   2          reg = XBYTE[SW1021_CHIP_ADDR(i) + SDH_CTRL_REG(A_BUS_BASE)];
1161   2          if( (reg & UP_DELAY_2) != UP_DELAY_2){
1162   3            ret = -1;
1163   3            break;
1164   3          }
1165   2          
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 20  

1166   2          reg = XBYTE[SW1021_CHIP_ADDR(i) + SDH_CTRL_REG(B_BUS_BASE)];
1167   2          if( (reg & UP_DELAY_2) != UP_DELAY_2){
1168   3            ret = -1;
1169   3            break;
1170   3          }
1171   2          
1172   2          for(j=0; j<21; j++){
1173   3            reg = XBYTE[SW1021_CHIP_ADDR(i) + PORT_CFG_REG(j)];
1174   3            if((reg & (A_UP_DOWN | RnEN)) != (A_UP_DOWN | RnEN)){
1175   4              ret = -1;
1176   4              goto quit;
1177   4            }
1178   3          }
1179   2      
1180   2        }
1181   1      quit:
1182   1        return ret;
1183   1      }
1184          
1185          /*****************************************************************
1186          ** º¯ÊýÃû:MAIN
1187          ** Êä¡¡Èë: ÎÞ
1188          ** Êä¡¡³ö: ÎÞ
1189          ** ¹¦ÄÜÃèÊö£ºÖ÷º¯Êý
1190          ** È«¾Ö±äÁ¿£ºg_QuarterFlag
1191          ** µ÷ÓÃÄ£¿é£ºSelfConf(),GetData(),ProcHisData(),Debug();
1192          ** ×÷¡¡Õß£ºcaijun.Li
1193          ** ÈÕ¡¡ÆÚ£º2016.3.18
1194          ** ÐÞ¡¡¸Ä£º
1195          ** ÈÕ¡¡ÆÚ£º
1196          ** °æ  ±¾£º1.0
1197          ****************************************************************/
1198          void main()
1199          {   
1200   1        unsigned char i;  
1201   1        int ret = 0;
1202   1        //Delay(50);
1203   1      
1204   1        SelfConf(); 
1205   1        
1206   1        ret = checkSW1021Init();
1207   1        if(ret != 0)
1208   1          InitioSw1021();
1209   1      
1210   1        while (1)
1211   1        {
1212   2          #ifdef SKIP_DEBUG_CHECK
1213   2            #ifdef NEED_LP_RFI        
                        XBYTE[0x7fe5] = 1;
                    #else
1216   2                XBYTE[0x7b74] = 1;
1217   2            #endif
1218   2          #endif
1219   2          
1220   2          //ACT = ~ACT;
1221   2          //RED = ~RED;
1222   2          //YELLOW = ~YELLOW;
1223   2              
1224   2          
1225   2          ret = checkSW1021Init();
1226   2          if(ret != 0){ 
1227   3            SelfConf(); 
C51 COMPILER V9.54   GF2488_01F1_E1_RST                                                    04/21/2016 08:33:44 PAGE 21  

1228   3            InitioSw1021();
1229   3            ConfSet();  
1230   3          }
1231   2        
1232   2          GetData();
1233   2          ProcAlmData();  
1234   2      
1235   2          if (g_QuarterFlag) 
1236   2          {
1237   3            UasQuarter();
1238   3            for(i=0;i<LINENUM;i++)
1239   3            {
1240   4              g_stuPm[i*PMTYPENUM].Value.usint=g_usiBbe[i];
1241   4              g_stuPm[i*PMTYPENUM+1].Value.usint=g_usiEs[i];
1242   4              g_stuPm[i*PMTYPENUM+2].Value.usint=g_usiSes[i];
1243   4            }
1244   3            ProcHisData();  //½«µ±Ç°¸æ¾¯ºÍÐÔÄÜÊý¾Ý´æÎªÀúÊ·Êý¾Ý//
1245   3            g_QuarterFlag=0;
1246   3          }
1247   2          
1248   2          Debug();
1249   2        }
1250   1      }
1251          
*** WARNING C294 IN LINE 820 OF GF2488-01F1-E1-RST.C: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  11225    ----
   CONSTANT SIZE    =    208    ----
   XDATA SIZE       =  22238      88
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
